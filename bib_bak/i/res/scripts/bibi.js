/*!
 *
 * # BiB/i - http://bibi.epub.link/ - Copyright (c) Satoru MATSUSHIMA - Licensed under the MIT license.
 *
 * - Open Source Libraries
 *
 *     1. JSZip     - http://stuartk.com/jszip              - Copyright (c) Stuart Knightley  - Dual licenced under the MIT license or GPLv3. - bibi-dev/res/scripts/lib/jszip.min.js
 *     2. base64.js - https://github.com/dankogai/js-base64 - Copyright (c) dankogai          - Licensed under the MIT license.               - bibi-dev/res/scripts/lib/base64.js
 *     3. easing.js - https://github.com/danro/easing-js    - Copyright (c) Dan Rogers        - Licensed under the MIT license.               - bibi-dev/res/scripts/lib/easing.js
 *     4. sML       - http://fracoco.co/sML                 - Copyright (c) Satoru MATSUSHIMA - Licensed under the MIT license.               - bibi-dev/res/scripts/lib/sML.js
 *
 * - BiB/i Components
 *
 *     1. BiB/i Core               - bibi-dev/res/scripts/src/bibi.core.js
 *     2. BiB/i EPUB-CFI Utilities - bibi-dev/res/scripts/src/bibi.epubcfi.js
 *
 */
/*!

JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZip=a():"undefined"!=typeof global?global.JSZip=a():"undefined"!=typeof self&&(self.JSZip=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,f,g,h,i,j="",k=0;k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),e=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|e>>6,i=63&e,isNaN(c)?h=i=64:isNaN(e)&&(i=64),j=j+d.charAt(f)+d.charAt(g)+d.charAt(h)+d.charAt(i);return j},c.decode=function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=d.indexOf(a.charAt(k++)),g=d.indexOf(a.charAt(k++)),h=d.indexOf(a.charAt(k++)),i=d.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(e));return j}},{}],2:[function(a,b){"use strict";function c(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}c.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},b.exports=c},{}],3:[function(a,b,c){"use strict";c.STORE={magic:"\x00\x00",compress:function(a){return a},uncompress:function(a){return a},compressInputType:null,uncompressInputType:null},c.DEFLATE=a("./flate")},{"./flate":6}],4:[function(a,b){"use strict";function c(){this.data=null,this.length=0,this.index=0}var d=a("./utils");c.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<a||0>a)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return d.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1)}},b.exports=c},{"./utils":14}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.date=null,c.compression=null},{}],6:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,e=a("pako");c.uncompressInputType=d?"uint8array":"array",c.compressInputType=d?"uint8array":"array",c.magic="\b\x00",c.compress=function(a){return e.deflateRaw(a)},c.uncompress=function(a){return e.inflateRaw(a)}},{pako:19}],7:[function(a,b){"use strict";function c(a,b){return this instanceof c?(this.files={},this.root="",a&&this.load(a,b),void(this.clone=function(){var a=new c;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a})):new c(a,b)}c.prototype=a("./object"),c.prototype.load=a("./load"),c.support=a("./support"),c.defaults=a("./defaults"),c.utils=a("./utils"),c.base64=a("./base64"),c.compressions=a("./compressions"),b.exports=c},{"./base64":1,"./compressions":3,"./defaults":5,"./load":8,"./object":9,"./support":12,"./utils":14}],8:[function(a,b){"use strict";var c=a("./base64"),d=a("./zipEntries");b.exports=function(a,b){var e,f,g,h;for(b=b||{},b.base64&&(a=c.decode(a)),f=new d(a,b),e=f.files,g=0;g<e.length;g++)h=e[g],this.file(h.fileName,h.decompressed,{binary:!0,optimizedBinaryString:!0,date:h.date,dir:h.dir});return this}},{"./base64":1,"./zipEntries":15}],9:[function(a,b){"use strict";var c,d,e=a("./support"),f=a("./utils"),g=a("./signature"),h=a("./defaults"),i=a("./base64"),j=a("./compressions"),k=a("./compressedObject"),l=a("./nodeBuffer");e.uint8array&&"function"==typeof TextEncoder&&"function"==typeof TextDecoder&&(c=new TextEncoder("utf-8"),d=new TextDecoder("utf-8"));var m=function(a){if(a._data instanceof k&&(a._data=a._data.getContent(),a.options.binary=!0,a.options.base64=!1,"uint8array"===f.getTypeOf(a._data))){var b=a._data;a._data=new Uint8Array(b.length),0!==b.length&&a._data.set(b,0)}return a._data},n=function(a){var b=m(a),d=f.getTypeOf(b);if("string"===d){if(!a.options.binary){if(c)return c.encode(b);if(e.nodebuffer)return l(b,"utf-8")}return a.asBinary()}return b},o=function(a){var b=m(this);return null===b||"undefined"==typeof b?"":(this.options.base64&&(b=i.decode(b)),b=a&&this.options.binary?A.utf8decode(b):f.transformTo("string",b),a||this.options.binary||(b=A.utf8encode(b)),b)},p=function(a,b,c){this.name=a,this._data=b,this.options=c};p.prototype={asText:function(){return o.call(this,!0)},asBinary:function(){return o.call(this,!1)},asNodeBuffer:function(){var a=n(this);return f.transformTo("nodebuffer",a)},asUint8Array:function(){var a=n(this);return f.transformTo("uint8array",a)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var q=function(a,b){var c,d="";for(c=0;b>c;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},r=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},s=function(a){return a=a||{},a.base64!==!0||null!==a.binary&&void 0!==a.binary||(a.binary=!0),a=r(a,h),a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),a},t=function(a,b,c){var d=u(a),e=f.getTypeOf(b);if(d&&v.call(this,d),c=s(c),c.dir||null===b||"undefined"==typeof b)c.base64=!1,c.binary=!1,b=null;else if("string"===e)c.binary&&!c.base64&&c.optimizedBinaryString!==!0&&(b=f.string2binary(b));else{if(c.base64=!1,c.binary=!0,!(e||b instanceof k))throw new Error("The data of '"+a+"' is in an unsupported format !");"arraybuffer"===e&&(b=f.transformTo("uint8array",b))}var g=new p(a,b,c);return this.files[a]=g,g},u=function(a){"/"==a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},v=function(a){return"/"!=a.slice(-1)&&(a+="/"),this.files[a]||t.call(this,a,null,{dir:!0}),this.files[a]},w=function(a,b){var c,d=new k;return a._data instanceof k?(d.uncompressedSize=a._data.uncompressedSize,d.crc32=a._data.crc32,0===d.uncompressedSize||a.options.dir?(b=j.STORE,d.compressedContent="",d.crc32=0):a._data.compressionMethod===b.magic?d.compressedContent=a._data.getCompressedContent():(c=a._data.getContent(),d.compressedContent=b.compress(f.transformTo(b.compressInputType,c)))):(c=n(a),(!c||0===c.length||a.options.dir)&&(b=j.STORE,c=""),d.uncompressedSize=c.length,d.crc32=this.crc32(c),d.compressedContent=b.compress(f.transformTo(b.compressInputType,c))),d.compressedSize=d.compressedContent.length,d.compressionMethod=b.magic,d},x=function(a,b,c,d){var e,f,h=(c.compressedContent,this.utf8encode(b.name)),i=h!==b.name,j=b.options,k="",l="";e=j.date.getHours(),e<<=6,e|=j.date.getMinutes(),e<<=5,e|=j.date.getSeconds()/2,f=j.date.getFullYear()-1980,f<<=4,f|=j.date.getMonth()+1,f<<=5,f|=j.date.getDate(),i&&(l=q(1,1)+q(this.crc32(h),4)+h,k+="up"+q(l.length,2)+l);var m="";m+="\n\x00",m+=i?"\x00\b":"\x00\x00",m+=c.compressionMethod,m+=q(e,2),m+=q(f,2),m+=q(c.crc32,4),m+=q(c.compressedSize,4),m+=q(c.uncompressedSize,4),m+=q(h.length,2),m+=q(k.length,2);var n=g.LOCAL_FILE_HEADER+m+h+k,o=g.CENTRAL_FILE_HEADER+"\x00"+m+"\x00\x00\x00\x00\x00\x00"+(b.options.dir===!0?"\x00\x00\x00":"\x00\x00\x00\x00")+q(d,4)+h+k;return{fileRecord:n,dirRecord:o,compressedObject:c}},y=function(){this.data=[]};y.prototype={append:function(a){a=f.transformTo("string",a),this.data.push(a)},finalize:function(){return this.data.join("")}};var z=function(a){this.data=new Uint8Array(a),this.index=0};z.prototype={append:function(a){0!==a.length&&(a=f.transformTo("uint8array",a),this.data.set(a,this.index),this.index+=a.length)},finalize:function(){return this.data}};var A={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(a){var b,c,d,e,f=[];for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],e=new p(d.name,d._data,r(d.options)),c=b.slice(this.root.length,b.length),b.slice(0,this.root.length)===this.root&&a(c,e)&&f.push(e));return f},file:function(a,b,c){if(1===arguments.length){if(f.isRegExp(a)){var d=a;return this.filter(function(a,b){return!b.options.dir&&d.test(a)})}return this.filter(function(b,c){return!c.options.dir&&b===a})[0]||null}return a=this.root+a,t.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(f.isRegExp(a))return this.filter(function(b,c){return c.options.dir&&a.test(b)});var b=this.root+a,c=v.call(this,b),d=this.clone();return d.root=c.name,d},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!=a.slice(-1)&&(a+="/"),b=this.files[a]),b)if(b.options.dir)for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];else delete this.files[a];return this},generate:function(a){a=r(a||{},{base64:!0,compression:"STORE",type:"base64"}),f.checkSupport(a.type);var b,c,d=[],e=0,h=0;for(var k in this.files)if(this.files.hasOwnProperty(k)){var l=this.files[k],m=l.options.compression||a.compression.toUpperCase(),n=j[m];if(!n)throw new Error(m+" is not a valid compression method !");var o=w.call(this,l,n),p=x.call(this,k,l,o,e);e+=p.fileRecord.length+o.compressedSize,h+=p.dirRecord.length,d.push(p)}var s="";s=g.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+q(d.length,2)+q(d.length,2)+q(h,4)+q(e,4)+"\x00\x00";var t=a.type.toLowerCase();for(b="uint8array"===t||"arraybuffer"===t||"blob"===t||"nodebuffer"===t?new z(e+h+s.length):new y(e+h+s.length),c=0;c<d.length;c++)b.append(d[c].fileRecord),b.append(d[c].compressedObject.compressedContent);for(c=0;c<d.length;c++)b.append(d[c].dirRecord);b.append(s);var u=b.finalize();switch(a.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return f.transformTo(a.type.toLowerCase(),u);case"blob":return f.arrayBuffer2Blob(f.transformTo("arraybuffer",u));case"base64":return a.base64?i.encode(u):u;default:return u}},crc32:function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==f.getTypeOf(a),d=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"==typeof b&&(b=0);var e=0,g=0,h=0;b=-1^b;for(var i=0,j=a.length;j>i;i++)h=c?a[i]:a.charCodeAt(i),g=255&(b^h),e=d[g],b=b>>>8^e;return-1^b},utf8encode:function(a){if(c){var b=c.encode(a);return f.transformTo("string",b)}if(e.nodebuffer)return f.transformTo("string",l(a,"utf-8"));for(var d=[],g=0,h=0;h<a.length;h++){var i=a.charCodeAt(h);128>i?d[g++]=String.fromCharCode(i):i>127&&2048>i?(d[g++]=String.fromCharCode(i>>6|192),d[g++]=String.fromCharCode(63&i|128)):(d[g++]=String.fromCharCode(i>>12|224),d[g++]=String.fromCharCode(i>>6&63|128),d[g++]=String.fromCharCode(63&i|128))}return d.join("")},utf8decode:function(a){var b=[],c=0,g=f.getTypeOf(a),h="string"!==g,i=0,j=0,k=0,l=0;if(d)return d.decode(f.transformTo("uint8array",a));if(e.nodebuffer)return f.transformTo("nodebuffer",a).toString("utf-8");for(;i<a.length;)j=h?a[i]:a.charCodeAt(i),128>j?(b[c++]=String.fromCharCode(j),i++):j>191&&224>j?(k=h?a[i+1]:a.charCodeAt(i+1),b[c++]=String.fromCharCode((31&j)<<6|63&k),i+=2):(k=h?a[i+1]:a.charCodeAt(i+1),l=h?a[i+2]:a.charCodeAt(i+2),b[c++]=String.fromCharCode((15&j)<<12|(63&k)<<6|63&l),i+=3);return b.join("")}};b.exports=A},{"./base64":1,"./compressedObject":2,"./compressions":3,"./defaults":5,"./nodeBuffer":17,"./signature":10,"./support":12,"./utils":14}],10:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],11:[function(a,b){"use strict";function c(a,b){this.data=a,b||(this.data=e.string2binary(this.data)),this.length=this.data.length,this.index=0}var d=a("./dataReader"),e=a("./utils");c.prototype=new d,c.prototype.byteAt=function(a){return this.data.charCodeAt(a)},c.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)},c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.index,this.index+a);return this.index+=a,b},b.exports=c},{"./dataReader":4,"./utils":14}],12:[function(a,b,c){var d=a("__browserify_process");if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer=!d.browser,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var e=new ArrayBuffer(0);try{c.blob=0===new Blob([e],{type:"application/zip"}).size}catch(f){try{var g=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,h=new g;h.append(e),c.blob=0===h.getBlob("application/zip").size}catch(f){c.blob=!1}}}},{__browserify_process:18}],13:[function(a,b){"use strict";function c(a){a&&(this.data=a,this.length=this.data.length,this.index=0)}var d=a("./dataReader");c.prototype=new d,c.prototype.byteAt=function(a){return this.data[a]},c.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f;return-1},c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.subarray(this.index,this.index+a);return this.index+=a,b},b.exports=c},{"./dataReader":4}],14:[function(a,b,c){"use strict";function d(a){return a}function e(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function f(a){var b=65536,d=[],e=a.length,f=c.getTypeOf(a),g=0,h=!0;try{switch(f){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,j(0))}}catch(i){h=!1}if(!h){for(var k="",l=0;l<a.length;l++)k+=String.fromCharCode(a[l]);return k}for(;e>g&&b>1;)try{d.push("array"===f||"nodebuffer"===f?String.fromCharCode.apply(null,a.slice(g,Math.min(g+b,e))):String.fromCharCode.apply(null,a.subarray(g,Math.min(g+b,e)))),g+=b}catch(i){b=Math.floor(b/2)}return d.join("")}function g(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var h=a("./support"),i=a("./compressions"),j=a("./nodeBuffer");c.string2binary=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(255&a.charCodeAt(c));return b},c.string2Uint8Array=function(a){return c.transformTo("uint8array",a)},c.uint8Array2String=function(a){return c.transformTo("string",a)},c.string2Blob=function(a){var b=c.transformTo("arraybuffer",a);return c.arrayBuffer2Blob(b)},c.arrayBuffer2Blob=function(a){c.checkSupport("blob");try{return new Blob([a],{type:"application/zip"})}catch(b){try{var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,e=new d;return e.append(a),e.getBlob("application/zip")}catch(b){throw new Error("Bug : can't construct the Blob.")}}};var k={};k.string={string:d,array:function(a){return e(a,new Array(a.length))},arraybuffer:function(a){return k.string.uint8array(a).buffer},uint8array:function(a){return e(a,new Uint8Array(a.length))},nodebuffer:function(a){return e(a,j(a.length))}},k.array={string:f,array:d,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return j(a)}},k.arraybuffer={string:function(a){return f(new Uint8Array(a))},array:function(a){return g(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:d,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return j(new Uint8Array(a))}},k.uint8array={string:f,array:function(a){return g(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:d,nodebuffer:function(a){return j(a)}},k.nodebuffer={string:f,array:function(a){return g(a,new Array(a.length))},arraybuffer:function(a){return k.nodebuffer.uint8array(a).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:d},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=k[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":h.nodebuffer&&j.test(a)?"nodebuffer":h.uint8array&&a instanceof Uint8Array?"uint8array":h.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=h[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this browser")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(16>b?"0":"")+b.toString(16).toUpperCase();return d},c.findCompression=function(a){for(var b in i)if(i.hasOwnProperty(b)&&i[b].magic===a)return i[b];return null},c.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)}},{"./compressions":3,"./nodeBuffer":17,"./support":12}],15:[function(a,b){"use strict";function c(a,b){this.files=[],this.loadOptions=b,a&&this.load(a)}var d=a("./stringReader"),e=a("./nodeBufferReader"),f=a("./uint8ArrayReader"),g=a("./utils"),h=a("./signature"),i=a("./zipEntry"),j=a("./support");c.prototype={checkSignature:function(a){var b=this.reader.readString(4);if(b!==a)throw new Error("Corrupted zip or bug : unexpected signature ("+g.pretty(b)+", expected "+g.pretty(a)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;d>e;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readString(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===h.CENTRAL_FILE_HEADER;)a=new i({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(-1===a)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(a),this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===g.MAX_VALUE_16BITS||this.diskWithCentralDirStart===g.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===g.MAX_VALUE_16BITS||this.centralDirRecords===g.MAX_VALUE_16BITS||this.centralDirSize===g.MAX_VALUE_32BITS||this.centralDirOffset===g.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===a)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(a){var b=g.getTypeOf(a);this.reader="string"!==b||j.uint8array?"nodebuffer"===b?new e(a):new f(g.transformTo("uint8array",a)):new d(a,this.loadOptions.optimizedBinaryString)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=c},{"./nodeBufferReader":17,"./signature":10,"./stringReader":11,"./support":12,"./uint8ArrayReader":13,"./utils":14,"./zipEntry":16}],16:[function(a,b){"use strict";function c(a,b){this.options=a,this.loadOptions=b}var d=a("./stringReader"),e=a("./utils"),f=a("./compressedObject"),g=a("./object");c.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(a,b,c){return function(){var d=a.index;a.setIndex(b);var e=a.readData(c);return a.setIndex(d),e}},prepareContent:function(a,b,c,d,f){return function(){var a=e.transformTo(d.uncompressInputType,this.getCompressedContent()),b=d.uncompress(a);if(b.length!==f)throw new Error("Bug : uncompressed data size mismatch");return b}},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readString(this.fileNameLength),a.skip(c),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(b=e.findCompression(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new f,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(a,a.index,this.compressedSize,b),this.decompressed.getContent=this.prepareContent(a,a.index,this.compressedSize,b,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=e.transformTo("string",this.decompressed.getContent()),g.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(a){if(this.versionMadeBy=a.readString(2),this.versionNeeded=a.readInt(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4),this.fileNameLength=a.readInt(2),this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=a.readString(this.fileNameLength),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readString(this.fileCommentLength),this.dir=16&this.externalFileAttributes?!0:!1},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=new d(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index;for(this.extraFields=this.extraFields||{};a.index<e+this.extraFieldsLength;)b=a.readInt(2),c=a.readInt(2),d=a.readString(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){if(this.useUTF8())this.fileName=g.utf8decode(this.fileName),this.fileComment=g.utf8decode(this.fileComment);else{var a=this.findExtraFieldUnicodePath();null!==a&&(this.fileName=a)}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=new d(a.value);return 1!==b.readInt(1)?null:g.crc32(this.fileName)!==b.readInt(4)?null:g.utf8decode(b.readString(a.length-5))}return null}},b.exports=c},{"./compressedObject":2,"./object":9,"./stringReader":11,"./utils":14}],17:[function(){},{}],18:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(a,b){"use strict";var c=a("./lib/utils/common").assign,d=a("./lib/deflate"),e=a("./lib/inflate"),f=a("./lib/zlib/constants"),g={};c(g,d,e,f),b.exports=g},{"./lib/deflate":20,"./lib/inflate":21,"./lib/utils/common":22,"./lib/zlib/constants":25}],20:[function(a,b,c){"use strict";function d(a,b){var c=new s(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}function f(a,b){return b=b||{},b.gzip=!0,d(a,b)}var g=a("./zlib/deflate.js"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=0,m=4,n=0,o=1,p=-1,q=0,r=8,s=function(a){this.options=h.assign({level:p,method:r,chunkSize:16384,windowBits:15,memLevel:8,strategy:q,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=g.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==n)throw new Error(j[c]);b.header&&g.deflateSetHeader(this.strm,b.header)};s.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?m:l,e.input="string"==typeof a?i.string2buf(a):a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new h.Buf8(f),e.next_out=0,e.avail_out=f),c=g.deflate(e,d),c!==o&&c!==n)return this.onEnd(c),this.ended=!0,!1;(0===e.avail_out||0===e.avail_in&&d===m)&&this.onData("string"===this.options.to?i.buf2binstring(h.shrinkBuf(e.output,e.next_out)):h.shrinkBuf(e.output,e.next_out))}while((e.avail_in>0||0===e.avail_out)&&c!==o);return d===m?(c=g.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===n):!0},s.prototype.onData=function(a){this.chunks.push(a)},s.prototype.onEnd=function(a){a===n&&(this.result="string"===this.options.to?this.chunks.join(""):h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=s,c.deflate=d,c.deflateRaw=e,c.gzip=f},{"./utils/common":22,"./utils/strings":23,"./zlib/deflate.js":27,"./zlib/messages":32,"./zlib/zstream":34}],21:[function(a,b,c){"use strict";function d(a,b){var c=new m(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}var f=a("./zlib/inflate.js"),g=a("./utils/common"),h=a("./utils/strings"),i=a("./zlib/constants"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=a("./zlib/gzheader"),m=function(a){this.options=g.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=f.inflateInit2(this.strm,b.windowBits);if(c!==i.Z_OK)throw new Error(j[c]);this.header=new l,f.inflateGetHeader(this.strm,this.header)};m.prototype.push=function(a,b){var c,d,e,j,k,l=this.strm,m=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,l.input="string"==typeof a?h.binstring2buf(a):a,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new g.Buf8(m),l.next_out=0,l.avail_out=m),c=f.inflate(l,i.Z_NO_FLUSH),c!==i.Z_STREAM_END&&c!==i.Z_OK)return this.onEnd(c),this.ended=!0,!1;l.next_out&&(0===l.avail_out||c===i.Z_STREAM_END||0===l.avail_in&&d===i.Z_FINISH)&&("string"===this.options.to?(e=h.utf8border(l.output,l.next_out),j=l.next_out-e,k=h.buf2string(l.output,e),l.next_out=j,l.avail_out=m-j,j&&g.arraySet(l.output,l.output,e,j,0),this.onData(k)):this.onData(g.shrinkBuf(l.output,l.next_out)))
}while((l.avail_in>0||0===l.avail_out)&&c!==i.Z_STREAM_END);return c===i.Z_STREAM_END&&(d=i.Z_FINISH),d===i.Z_FINISH?(c=f.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===i.Z_OK):!0},m.prototype.onData=function(a){this.chunks.push(a)},m.prototype.onEnd=function(a){a===i.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):g.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=m,c.inflate=d,c.inflateRaw=e,c.ungzip=d},{"./utils/common":22,"./utils/strings":23,"./zlib/constants":25,"./zlib/gzheader":28,"./zlib/inflate.js":30,"./zlib/messages":32,"./zlib/zstream":34}],22:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;c>b;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;c>b;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],23:[function(a,b,c){"use strict";var d=a("./common"),e=!0;try{String.fromCharCode.apply(null,[0])}catch(f){e=!1}for(var g=new d.Buf8(256),h=0;256>h;h++)g[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;g[254]=g[254]=1,c.string2buf=function(a){var b,c,e,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(e=a.charCodeAt(f+1),56320===(64512&e)&&(c=65536+(c-55296<<10)+(e-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=new d.Buf8(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(e=a.charCodeAt(f+1),56320===(64512&e)&&(c=65536+(c-55296<<10)+(e-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){if(e&&a.length<65537)return String.fromCharCode.apply(null,a);for(var b="",c=0,d=a.length;d>c;c++)b+=String.fromCharCode(a[c]);return b},c.binstring2buf=function(a){for(var b=new d.Buf8(a.length),c=0,e=b.length;e>c;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,f,h,i,j,k=b||a.length,l=new Array(2*k);for(h=0,f=0;k>f;)if(i=a[f++],128>i)l[h++]=i;else if(j=g[i],j>4)l[h++]=65533,f+=j-1;else{for(i&=2===j?31:3===j?15:7;j>1&&k>f;)i=i<<6|63&a[f++],j--;j>1?l[h++]=65533:65536>i?l[h++]=i:(i-=65536,l[h++]=55296|i>>10&1023,l[h++]=56320|1023&i)}if(e)return String.fromCharCode.apply(null,d.shrinkBuf(l,h));for(c="",f=0,k=h;k>f;f++)c+=String.fromCharCode(l[f]);return c},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+g[a[c]]>b?c:b}},{"./common":22}],24:[function(a,b){"use strict";function c(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=c},{}],25:[function(a,b){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],26:[function(a,b){"use strict";function c(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function d(a,b,c,d){var f=e,g=d+c;a=-1^a;for(var h=d;g>h;h++)a=a>>>8^f[255&(a^b[h])];return-1^a}var e=c();b.exports=d},{}],27:[function(a,b,c){"use strict";function d(a,b){return a.msg=G[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(C.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){D._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,C.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=E(a.adler,b,e,c):2===a.state.wrap&&(a.adler=F(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-jb?a.strstart-(a.w_size-jb):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ib,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&m>f);if(d=ib-(m-f),f=m-ib,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-jb)){C.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=hb)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+hb-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<hb)););}while(a.lookahead<jb&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===H)return sb;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return sb;if(a.strstart-a.block_start>=a.w_size-jb&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?sb:sb}function o(a,b){for(var c,d;;){if(a.lookahead<jb){if(m(a),a.lookahead<jb&&b===H)return sb;if(0===a.lookahead)break}if(c=0,a.lookahead>=hb&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-jb&&(a.match_length=l(a,c)),a.match_length>=hb)if(d=D._tr_tally(a,a.strstart-a.match_start,a.match_length-hb),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=hb){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=a.strstart<hb-1?a.strstart:hb-1,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function p(a,b){for(var c,d,e;;){if(a.lookahead<jb){if(m(a),a.lookahead<jb&&b===H)return sb;if(0===a.lookahead)break}if(c=0,a.lookahead>=hb&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=hb-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-jb&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===S||a.match_length===hb&&a.strstart-a.match_start>4096)&&(a.match_length=hb-1)),a.prev_length>=hb&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-hb,d=D._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-hb),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=hb-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return sb}else if(a.match_available){if(d=D._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return sb}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=D._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<hb-1?a.strstart:hb-1,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ib){if(m(a),a.lookahead<=ib&&b===H)return sb;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=hb&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ib;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&f>e);a.match_length=ib-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=hb?(c=D._tr_tally(a,1,a.match_length-hb),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===H)return sb;break}if(a.match_length=0,c=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function s(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=B[a.level].max_lazy,a.good_match=B[a.level].good_length,a.nice_match=B[a.level].nice_length,a.max_chain_length=B[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=hb-1,a.match_available=0,a.ins_h=0}function t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new C.Buf16(2*fb),this.dyn_dtree=new C.Buf16(2*(2*db+1)),this.bl_tree=new C.Buf16(2*(2*eb+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new C.Buf16(gb+1),this.heap=new C.Buf16(2*cb+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new C.Buf16(2*cb+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function u(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=X,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?lb:qb,a.adler=2===b.wrap?0:1,b.last_flush=H,D._tr_init(b),M):d(a,O)}function v(a){var b=u(a);return b===M&&s(a.state),b}function w(a,b){return a&&a.state?2!==a.state.wrap?O:(a.state.gzhead=b,M):O}function x(a,b,c,e,f,g){if(!a)return O;var h=1;if(b===R&&(b=6),0>e?(h=0,e=-e):e>15&&(h=2,e-=16),1>f||f>Z||c!==Y||8>e||e>15||0>b||b>9||0>g||g>V)return d(a,O);8===e&&(e=9);var i=new t;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+hb-1)/hb),i.window=new C.Buf8(2*i.w_size),i.head=new C.Buf16(i.hash_size),i.prev=new C.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new C.Buf8(i.pending_buf_size),i.d_buf=i.lit_bufsize>>1,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,v(a)}function y(a,b){return x(a,b,Y,$,_,W)}function z(a,b){var c,h,k,l;if(!a||!a.state||b>L||0>b)return a?d(a,O):O;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===rb&&b!==K)return d(a,0===a.avail_out?Q:O);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===lb)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=T||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=F(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=mb):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=T||h.level<2?4:0),i(h,wb),h.status=qb);else{var m=Y+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=T||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=kb),m+=31-m%31,h.status=qb,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===mb)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=nb)}else h.status=nb;if(h.status===nb)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=ob)}else h.status=ob;if(h.status===ob)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=pb)}else h.status=pb;if(h.status===pb&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=qb)):h.status=qb),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,M}else if(0===a.avail_in&&e(b)<=e(c)&&b!==K)return d(a,Q);if(h.status===rb&&0!==a.avail_in)return d(a,Q);if(0!==a.avail_in||0!==h.lookahead||b!==H&&h.status!==rb){var o=h.strategy===T?r(h,b):h.strategy===U?q(h,b):B[h.level].func(h,b);if((o===ub||o===vb)&&(h.status=rb),o===sb||o===ub)return 0===a.avail_out&&(h.last_flush=-1),M;if(o===tb&&(b===I?D._tr_align(h):b!==L&&(D._tr_stored_block(h,0,0,!1),b===J&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,M}return b!==K?M:h.wrap<=0?N:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?M:N)}function A(a){var b;return a&&a.state?(b=a.state.status,b!==lb&&b!==mb&&b!==nb&&b!==ob&&b!==pb&&b!==qb&&b!==rb?d(a,O):(a.state=null,b===qb?d(a,P):M)):O}var B,C=a("../utils/common"),D=a("./trees"),E=a("./adler32"),F=a("./crc32"),G=a("./messages"),H=0,I=1,J=3,K=4,L=5,M=0,N=1,O=-2,P=-3,Q=-5,R=-1,S=1,T=2,U=3,V=4,W=0,X=2,Y=8,Z=9,$=15,_=8,ab=29,bb=256,cb=bb+1+ab,db=30,eb=19,fb=2*cb+1,gb=15,hb=3,ib=258,jb=ib+hb+1,kb=32,lb=42,mb=69,nb=73,ob=91,pb=103,qb=113,rb=666,sb=1,tb=2,ub=3,vb=4,wb=3,xb=function(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e};B=[new xb(0,0,0,0,n),new xb(4,4,8,4,o),new xb(4,5,16,8,o),new xb(4,6,32,32,o),new xb(4,4,16,16,p),new xb(8,16,32,32,p),new xb(8,16,128,128,p),new xb(8,32,128,256,p),new xb(32,128,258,1024,p),new xb(32,258,258,4096,p)],c.deflateInit=y,c.deflateInit2=x,c.deflateReset=v,c.deflateResetKeep=u,c.deflateSetHeader=w,c.deflate=z,c.deflateEnd=A,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":22,"./adler32":24,"./crc32":26,"./messages":32,"./trees":33}],28:[function(a,b){"use strict";function c(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=c},{}],29:[function(a,b){"use strict";var c=30,d=12;b.exports=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;e=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=e.dmax,l=e.wsize,m=e.whave,n=e.wnext,o=e.window,p=e.hold,q=e.bits,r=e.lencode,s=e.distcode,t=(1<<e.lenbits)-1,u=(1<<e.distbits)-1;a:do{15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){e.mode=d;break a}a.msg="invalid literal/length code",e.mode=c;break a}x=65535&v,w&=15,w&&(w>q&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",e.mode=c;break a}if(y=65535&v,w&=15,w>q&&(p+=B[f++]<<q,q+=8,w>q&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",e.mode=c;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&e.sane){a.msg="invalid distance too far back",e.mode=c;break a}if(z=0,A=o,0===n){if(z+=l-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(w>n){if(z+=l+n-w,w-=n,x>w){x-=w;do C[h++]=o[z++];while(--w);if(z=0,x>n){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(g>f&&j>h);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=g>f?5+(g-f):5-(f-g),a.avail_out=j>h?257+(j-h):257-(h-j),e.hold=p,e.bits=q}},{}],30:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=K,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new r.Buf32(ob),b.distcode=b.distdyn=new r.Buf32(pb),b.sane=1,b.back=-1,C):F}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):F}function h(a,b){var c,d;return a&&a.state?(d=a.state,0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15)),b&&(8>b||b>15)?F:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):F}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==C&&(a.state=null),c):F}function j(a){return i(a,rb)}function k(a){if(sb){var b;for(p=new r.Buf32(512),q=new r.Buf32(32),b=0;144>b;)a.lens[b++]=8;for(;256>b;)a.lens[b++]=9;for(;280>b;)a.lens[b++]=7;for(;288>b;)a.lens[b++]=8;for(v(x,a.lens,0,288,p,0,a.work,{bits:9}),b=0;32>b;)a.lens[b++]=5;v(y,a.lens,0,32,q,0,a.work,{bits:5}),sb=!1}a.lencode=p,a.lenbits=9,a.distcode=q,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new r.Buf8(f.wsize)),d>=f.wsize?(r.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),r.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(r.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab=0,Bb=new r.Buf8(4),Cb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return F;c=a.state,c.mode===V&&(c.mode=W),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xb=C;a:for(;;)switch(c.mode){case K:if(0===c.wrap){c.mode=W;break}for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0),m=0,n=0,c.mode=L;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=lb;break}if((15&m)!==J){a.msg="unknown compression method",c.mode=lb;break}if(m>>>=4,n-=4,wb=(15&m)+8,0===c.wbits)c.wbits=wb;else if(wb>c.wbits){a.msg="invalid window size",c.mode=lb;break}c.dmax=1<<wb,a.adler=c.check=1,c.mode=512&m?T:V,m=0,n=0;break;case L:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==J){a.msg="unknown compression method",c.mode=lb;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=lb;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0,c.mode=M;case M:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,Bb[2]=m>>>16&255,Bb[3]=m>>>24&255,c.check=t(c.check,Bb,4,0)),m=0,n=0,c.mode=N;case N:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0,c.mode=O;case O:if(1024&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=P;case P:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wb=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),r.arraySet(c.head.extra,e,g,q,wb)),512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=Q;case Q:if(2048&c.flags){if(0===i)break a;q=0;do wb=e[g+q++],c.head&&wb&&c.length<65536&&(c.head.name+=String.fromCharCode(wb));while(wb&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wb)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=R;case R:if(4096&c.flags){if(0===i)break a;q=0;do wb=e[g+q++],c.head&&wb&&c.length<65536&&(c.head.comment+=String.fromCharCode(wb));while(wb&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wb)break a}else c.head&&(c.head.comment=null);c.mode=S;case S:if(512&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=lb;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=V;break;case T:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=U;case U:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,E;a.adler=c.check=1,c.mode=V;case V:if(b===A||b===B)break a;case W:if(c.last){m>>>=7&n,n-=7&n,c.mode=ib;break}for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=X;break;case 1:if(k(c),c.mode=bb,b===B){m>>>=2,n-=2;break a}break;case 2:c.mode=$;break;case 3:a.msg="invalid block type",c.mode=lb}m>>>=2,n-=2;break;case X:for(m>>>=7&n,n-=7&n;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=lb;break}if(c.length=65535&m,m=0,n=0,c.mode=Y,b===B)break a;case Y:c.mode=Z;case Z:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;r.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=V;break;case $:for(;14>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=lb;break}c.have=0,c.mode=_;case _:for(;c.have<c.ncode;){for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Cb[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Cb[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,yb={bits:c.lenbits},xb=v(w,c.lens,0,19,c.lencode,0,c.work,yb),c.lenbits=yb.bits,xb){a.msg="invalid code lengths set",c.mode=lb;break}c.have=0,c.mode=ab;case ab:for(;c.have<c.nlen+c.ndist;){for(;Ab=c.lencode[m&(1<<c.lenbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(16>sb)m>>>=qb,n-=qb,c.lens[c.have++]=sb;else{if(16===sb){for(zb=qb+2;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qb,n-=qb,0===c.have){a.msg="invalid bit length repeat",c.mode=lb;break}wb=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sb){for(zb=qb+3;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qb,n-=qb,wb=0,q=3+(7&m),m>>>=3,n-=3}else{for(zb=qb+7;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qb,n-=qb,wb=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=lb;break}for(;q--;)c.lens[c.have++]=wb}}if(c.mode===lb)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=lb;break}if(c.lenbits=9,yb={bits:c.lenbits},xb=v(x,c.lens,0,c.nlen,c.lencode,0,c.work,yb),c.lenbits=yb.bits,xb){a.msg="invalid literal/lengths set",c.mode=lb;break}if(c.distbits=6,c.distcode=c.distdyn,yb={bits:c.distbits},xb=v(y,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,yb),c.distbits=yb.bits,xb){a.msg="invalid distances set",c.mode=lb;break}if(c.mode=bb,b===B)break a;case bb:c.mode=cb;case cb:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,u(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===V&&(c.back=-1);break}for(c.back=0;Ab=c.lencode[m&(1<<c.lenbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(rb&&0===(240&rb)){for(tb=qb,ub=rb,vb=sb;Ab=c.lencode[vb+((m&(1<<tb+ub)-1)>>tb)],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=tb+qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=tb,n-=tb,c.back+=tb}if(m>>>=qb,n-=qb,c.back+=qb,c.length=sb,0===rb){c.mode=hb;break}if(32&rb){c.back=-1,c.mode=V;break}if(64&rb){a.msg="invalid literal/length code",c.mode=lb;break}c.extra=15&rb,c.mode=db;case db:if(c.extra){for(zb=c.extra;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=eb;case eb:for(;Ab=c.distcode[m&(1<<c.distbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&rb)){for(tb=qb,ub=rb,vb=sb;Ab=c.distcode[vb+((m&(1<<tb+ub)-1)>>tb)],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=tb+qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=tb,n-=tb,c.back+=tb}if(m>>>=qb,n-=qb,c.back+=qb,64&rb){a.msg="invalid distance code",c.mode=lb;break}c.offset=sb,c.extra=15&rb,c.mode=fb;case fb:if(c.extra){for(zb=c.extra;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=lb;break}c.mode=gb;case gb:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=lb;break}q>c.wnext?(q-=c.wnext,ob=c.wsize-q):ob=c.wnext-q,q>c.length&&(q=c.length),pb=c.window}else pb=f,ob=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pb[ob++];while(--q);0===c.length&&(c.mode=cb);break;case hb:if(0===j)break a;f[h++]=c.length,j--,c.mode=cb;break;case ib:if(c.wrap){for(;32>n;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?t(c.check,f,p,h-p):s(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=lb;break}m=0,n=0}c.mode=jb;case jb:if(c.wrap&&c.flags){for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=lb;break}m=0,n=0}c.mode=kb;case kb:xb=D;break a;case lb:xb=G;break a;case mb:return H;case nb:default:return F}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<lb&&(c.mode<ib||b!==z))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=mb,H):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?t(c.check,f,p,a.next_out-p):s(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===V?128:0)+(c.mode===bb||c.mode===Y?256:0),(0===o&&0===p||b===z)&&xb===C&&(xb=I),xb)}function n(a){if(!a||!a.state)return F;var b=a.state;return b.window&&(b.window=null),a.state=null,C}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?F:(c.head=b,b.done=!1,C)):F}var p,q,r=a("../utils/common"),s=a("./adler32"),t=a("./crc32"),u=a("./inffast"),v=a("./inftrees"),w=0,x=1,y=2,z=4,A=5,B=6,C=0,D=1,E=2,F=-2,G=-3,H=-4,I=-5,J=8,K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9,T=10,U=11,V=12,W=13,X=14,Y=15,Z=16,$=17,_=18,ab=19,bb=20,cb=21,db=22,eb=23,fb=24,gb=25,hb=26,ib=27,jb=28,kb=29,lb=30,mb=31,nb=32,ob=852,pb=592,qb=15,rb=qb,sb=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":22,"./adler32":24,"./crc32":26,"./inffast":29,"./inftrees":31}],31:[function(a,b){"use strict";var c=a("../utils/common"),d=15,e=852,f=592,g=0,h=1,i=2,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];
b.exports=function(a,b,n,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new c.Buf16(d+1),Q=new c.Buf16(d+1),R=null,S=0;for(D=0;d>=D;D++)P[D]=0;for(E=0;o>E;E++)P[b[n+E]]++;for(H=C,G=d;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;G>F&&0===P[F];F++);for(F>H&&(H=F),K=1,D=1;d>=D;D++)if(K<<=1,K-=P[D],0>K)return-1;if(K>0&&(a===g||1!==G))return-1;for(Q[1]=0,D=1;d>D;D++)Q[D+1]=Q[D]+P[D];for(E=0;o>E;E++)0!==b[n+E]&&(r[Q[b[n+E]]++]=E);switch(a){case g:N=R=r,y=19;break;case h:N=j,O-=257,R=k,S-=257,y=256;break;default:N=l,R=m,y=-1}if(M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===h&&L>e||a===i&&L>f)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[n+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;G>I+J&&(K-=P[I+J],!(0>=K));)I++,K<<=1;if(L+=1<<I,a===h&&L>e||a===i&&L>f)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":22}],32:[function(a,b){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],33:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a){return 256>a?gb[a]:gb[256+(a>>>7)]}function f(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function g(a,b,c){a.bi_valid>V-c?(a.bi_buf|=b<<a.bi_valid&65535,f(a,a.bi_buf),a.bi_buf=b>>V-a.bi_valid,a.bi_valid+=c-V):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function h(a,b,c){g(a,c[2*b],c[2*b+1])}function i(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function j(a){16===a.bi_valid?(f(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function k(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;U>=f;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;T>c;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function l(a,b,c){var d,e,f=new Array(U+1),g=0;for(d=1;U>=d;d++)f[d]=g=g+c[d-1]<<1;for(e=0;b>=e;e++){var h=a[2*e+1];0!==h&&(a[2*e]=i(f[h]++,h))}}function m(){var a,b,c,d,e,f=new Array(U+1);for(c=0,d=0;O-1>d;d++)for(ib[d]=c,a=0;a<1<<_[d];a++)hb[c++]=d;for(hb[c-1]=d,e=0,d=0;16>d;d++)for(jb[d]=e,a=0;a<1<<ab[d];a++)gb[e++]=d;for(e>>=7;R>d;d++)for(jb[d]=e<<7,a=0;a<1<<ab[d]-7;a++)gb[256+e++]=d;for(b=0;U>=b;b++)f[b]=0;for(a=0;143>=a;)eb[2*a+1]=8,a++,f[8]++;for(;255>=a;)eb[2*a+1]=9,a++,f[9]++;for(;279>=a;)eb[2*a+1]=7,a++,f[7]++;for(;287>=a;)eb[2*a+1]=8,a++,f[8]++;for(l(eb,Q+1,f),a=0;R>a;a++)fb[2*a+1]=5,fb[2*a]=i(a,5);kb=new nb(eb,_,P+1,Q,U),lb=new nb(fb,ab,0,R,U),mb=new nb(new Array(0),bb,0,S,W)}function n(a){var b;for(b=0;Q>b;b++)a.dyn_ltree[2*b]=0;for(b=0;R>b;b++)a.dyn_dtree[2*b]=0;for(b=0;S>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*X]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function o(a){a.bi_valid>8?f(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function p(a,b,c,d){o(a),d&&(f(a,c),f(a,~c)),E.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function q(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function r(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&q(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!q(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function s(a,b,c){var d,f,i,j,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],f=a.pending_buf[a.l_buf+k],k++,0===d?h(a,f,b):(i=hb[f],h(a,i+P+1,b),j=_[i],0!==j&&(f-=ib[i],g(a,f,j)),d--,i=e(d),h(a,i,c),j=ab[i],0!==j&&(d-=jb[i],g(a,d,j)));while(k<a.last_lit);h(a,X,b)}function t(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=T,c=0;i>c;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=2>j?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)r(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],r(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,r(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],k(a,b),l(f,j,a.bl_count)}function u(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;c>=d;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(j>h?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*Y]++):10>=h?a.bl_tree[2*Z]++:a.bl_tree[2*$]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function v(a,b,c){var d,e,f=-1,i=b[1],j=0,k=7,l=4;for(0===i&&(k=138,l=3),d=0;c>=d;d++)if(e=i,i=b[2*(d+1)+1],!(++j<k&&e===i)){if(l>j){do h(a,e,a.bl_tree);while(0!==--j)}else 0!==e?(e!==f&&(h(a,e,a.bl_tree),j--),h(a,Y,a.bl_tree),g(a,j-3,2)):10>=j?(h(a,Z,a.bl_tree),g(a,j-3,3)):(h(a,$,a.bl_tree),g(a,j-11,7));j=0,f=e,0===i?(k=138,l=3):e===i?(k=6,l=3):(k=7,l=4)}}function w(a){var b;for(u(a,a.dyn_ltree,a.l_desc.max_code),u(a,a.dyn_dtree,a.d_desc.max_code),t(a,a.bl_desc),b=S-1;b>=3&&0===a.bl_tree[2*cb[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function x(a,b,c,d){var e;for(g(a,b-257,5),g(a,c-1,5),g(a,d-4,4),e=0;d>e;e++)g(a,a.bl_tree[2*cb[e]+1],3);v(a,a.dyn_ltree,b-1),v(a,a.dyn_dtree,c-1)}function y(a){var b,c=4093624447;for(b=0;31>=b;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return G;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return H;for(b=32;P>b;b++)if(0!==a.dyn_ltree[2*b])return H;return G}function z(a){pb||(m(),pb=!0),a.l_desc=new ob(a.dyn_ltree,kb),a.d_desc=new ob(a.dyn_dtree,lb),a.bl_desc=new ob(a.bl_tree,mb),a.bi_buf=0,a.bi_valid=0,n(a)}function A(a,b,c,d){g(a,(J<<1)+(d?1:0),3),p(a,b,c,!0)}function B(a){g(a,K<<1,3),h(a,X,eb),j(a)}function C(a,b,c,d){var e,f,h=0;a.level>0?(a.strm.data_type===I&&(a.strm.data_type=y(a)),t(a,a.l_desc),t(a,a.d_desc),h=w(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,e>=f&&(e=f)):e=f=c+5,e>=c+4&&-1!==b?A(a,b,c,d):a.strategy===F||f===e?(g(a,(K<<1)+(d?1:0),3),s(a,eb,fb)):(g(a,(L<<1)+(d?1:0),3),x(a,a.l_desc.max_code+1,a.d_desc.max_code+1,h+1),s(a,a.dyn_ltree,a.dyn_dtree)),n(a),d&&o(a)}function D(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(hb[c]+P+1)]++,a.dyn_dtree[2*e(b)]++),a.last_lit===a.lit_bufsize-1}var E=a("../utils/common"),F=4,G=0,H=1,I=2,J=0,K=1,L=2,M=3,N=258,O=29,P=256,Q=P+1+O,R=30,S=19,T=2*Q+1,U=15,V=16,W=7,X=256,Y=16,Z=17,$=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ab=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],bb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],cb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],db=512,eb=new Array(2*(Q+2));d(eb);var fb=new Array(2*R);d(fb);var gb=new Array(db);d(gb);var hb=new Array(N-M+1);d(hb);var ib=new Array(O);d(ib);var jb=new Array(R);d(jb);var kb,lb,mb,nb=function(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length},ob=function(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b},pb=!1;c._tr_init=z,c._tr_stored_block=A,c._tr_flush_block=C,c._tr_tally=D,c._tr_align=B},{"../utils/common":22}],34:[function(a,b){"use strict";function c(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=c},{}]},{},[7])(7)}),/*!
 *
 * $Id: base64.js,v 2.6 2012/08/24 05:23:18 dankogai Exp dankogai $
 *
 *  Licensed under the MIT license.
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  References:
 *    http://en.wikipedia.org/wiki/Base64
 */
function(a){"use strict";var b;"undefined"!=typeof module&&module.exports&&(b=require("buffer").Buffer);var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a.charAt(c)]=c;return b}(c),e=String.fromCharCode,f=function(a){var b=a.charCodeAt(0);return 128>b?a:2048>b?e(192|b>>>6)+e(128|63&b):e(224|b>>>12&15)+e(128|b>>>6&63)+e(128|63&b)},g=function(a){return a.replace(/[^\x00-\x7F]/g,f)},h=function(a){var b=[0,2,1][a.length%3],d=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),e=[c.charAt(d>>>18),c.charAt(d>>>12&63),b>=2?"=":c.charAt(d>>>6&63),b>=1?"=":c.charAt(63&d)];return e.join("")},i=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,h)},j=b?function(a){return new b(a).toString("base64")}:function(a){return i(g(a))},k=function(a,b){return b?j(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}):j(a)},l=function(a){return k(a,!0)},m=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}/g,n=function(a){return e(a.length<3?(31&a.charCodeAt(0))<<6|63&a.charCodeAt(1):(15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2))},o=function(a){return a.replace(m,n)},p=function(a){var b=a.length,c=b%4,f=(b>0?d[a.charAt(0)]<<18:0)|(b>1?d[a.charAt(1)]<<12:0)|(b>2?d[a.charAt(2)]<<6:0)|(b>3?d[a.charAt(3)]:0),g=[e(f>>>16),e(f>>>8&255),e(255&f)];return g.length-=[0,0,2,1][c],g.join("")},q=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,p)},r=b?function(a){return new b(a,"base64").toString()}:function(a){return o(q(a))},s=function(a){return r(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(a.Base64={atob:q,btoa:i,fromBase64:s,toBase64:k,utob:g,encode:k,encodeURI:l,btou:o,decode:s},"function"==typeof Object.defineProperty){var t=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",t(function(){return s(this)})),Object.defineProperty(String.prototype,"toBase64",t(function(a){return k(this,a)}))}}}(this),/*!
// --------------------------------------------------
// easing.js v0.5.4
// Generic set of easing functions with AMD support
// https://github.com/danro/easing-js
// This code may be freely distributed under the MIT license
// http://danro.mit-license.org/
// --------------------------------------------------
// All functions adapted from Thomas Fuchs & Jeremy Kahn
// Easing Equations (c) 2003 Robert Penner, BSD license
// https://raw.github.com/danro/easing-js/master/LICENSE
// --------------------------------------------------
 */
function(a,b){"function"==typeof define?define(b):"undefined"!=typeof module?module.exports=b:this[a]=b}("easing",{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){return(a/=.5)<1?.5*Math.pow(a,5):.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin(2*(6*a-1)*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?2-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},easeFromTo:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,.25)}}),/*!
 *
 * # sML JavaScript Library
 *
 * - "I'm a Simple and Middling Library."
 * - Copyright (c) Satoru MATSUSHIMA - http://sarasa.la/sML
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 * - Thu October 15 23:44:00 2014 +0900
 */
sML={Version:"0.999.9",Build:20141015},sML.DeviceName=sML.DN=function(a,b){var c=/(iPod|iPhone|iPad)( Simulator)?;/.test(a)?b(a,/^.+? OS ([\d_]+).+$/):void 0,d=/Android /.test(a)?b(a,/^.+? Android ([\d\.]+).+$/):void 0;return sML.OperatingSystem=sML.OS={OSX:a.indexOf("Mac")>-1&&!c?1:void 0,Windows:a.indexOf("Windows")>-1?1:void 0,Linux:a.indexOf("Linux")>-1&&!d?1:void 0,iOS:c,Android:d},sML.UserAgent=sML.UA={WebKit:a.indexOf("AppleWebKit")>-1?b(a,/^.+AppleWebKit\/([\d\.]+).+$/):void 0,Safari:a.indexOf("Safari/")>-1?b(a,/^.+Version\/([\d\.]+).+$/):void 0,Chrome:a.indexOf("Chrome/")>-1?b(a,/^.+Chrome\/([\d\.]+).+$/):void 0,Gecko:a.indexOf("Gecko/")>-1?b(a,/^.+rv\:([\d\.]+).+$/):void 0,Firefox:a.indexOf("Firefox/")>-1?b(a,/^.+Firefox\/([\d\.]+).+$/):void 0,Presto:a.indexOf("Presto")>-1?b(a,/^.+Presto\/([\d\.]+).+$/):void 0,Opera:a.indexOf("OPR/")>-1?b(a,/^.+OPR\/([\d\.]+).*$/):void 0,Trident:a.indexOf("Trident/")>-1?b(a,/^.+Trident\/([\d\.]+).*$/):void 0,InternetExplorer:a.indexOf("MSIE ")>-1?b(a,/^.+MSIE ([\d\.]+).*$/):void 0,Flash:void 0},sML.UA.Trident>=7&&(sML.UA.InternetExplorer=b(a,/^.+rv:([\d\.]+).*$/)),sML.UA.Opera||(sML.UA.Opera=a.indexOf("Opera/")>-1?b(a,/^.+Version\/([\d\.]+).*$/):void 0),sML.OS.OSX?"Mac":sML.OS.Windows?"PC":sML.OS.Linux?"PC":sML.OS.iOS?a.replace(/^.+?(iPod|iPhone|iPad)( Simulator)?;.+$/,"$1"):sML.OS.Android?a.replace(/^.+?\(.+?; ([^;]+)\).+$/,"$1"):""}(navigator.userAgent,function(a,b){var c=parseFloat(a.replace(b,"$1").replace(/[_\.]/g,",").replace(/\,/,".").replace(/\,/g,""));return isNaN(c)?void 0:c});try{sML.UA.Flash=parseFloat(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description.replace(/^.+?([\d\.]+).*$/,"$1"))}catch(e){}if(sML.UA.InternetExplorer)try{sML.UA.Flash=parseFloat(new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version").replace(/^[^\d]+(\d+)\,([\d\,]+)$/,"$1.$2").replace(/\,/g,""))}catch(e){}sML.OS.Mac=sML.OS.OSX,sML.OS.Win=sML.OS.Windows,sML.OS.Lin=sML.OS.Linux,sML.OS.And=sML.OS.Android,sML.UA.WK=sML.UA.WebKit,sML.UA.Sa=sML.UA.Safari,sML.UA.Ch=sML.UA.Chrome,sML.UA.Ge=sML.UA.Gecko,sML.UA.Fx=sML.UA.Firefox,sML.UA.Pr=sML.UA.Presto,sML.UA.Op=sML.UA.Opera,sML.UA.Tr=sML.UA.Trident,sML.UA.IE=sML.UA.InternetExplorer,sML.UA.Fl=sML.UA.Flash,sML.UA.Opera&&!window.console&&(console={log:opera.postError}),sML.log=function(){for(var a=arguments[0],b=arguments.length,c=1;b>c;c++)a+=", "+arguments[c];try{return console.log(a)}catch(d){}},sML.write=function(){document.open();for(var a=arguments.length,b=0;a>b;b++)document.write(arguments[b]);document.close()},sML.Polyfill={extendElements:function(a){return a}},sML.UA.InternetExplorer<9&&(sML.Polyfill.extendElement=function(a){return a.getElementsByClassName=sML.Polyfill.getElementsByClassName,a.addEventListener=sML.Polyfill.addEventListener,a.removeEventListener=sML.Polyfill.removeEventListener,a},sML.Polyfill.extendElements=function(a){return sML.Polyfill.extendElement(a),sML.each(a.getElementsByTagName("*"),function(){sML.Polyfill.extendElement(this)}),a},sML.Polyfill.getElementsByClassName=function(a){return this.querySelectorAll("."+a.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/,"."))},sML.Polyfill.addEventListener=function(a,b){this["FunctionsOn"+a]||(this["FunctionsOn"+a]=[],this["XWrappersOn"+a]=[]);var c=this,d=this["FunctionsOn"+a],e=this["XWrappersOn"+a];if("DOMContentLoaded"==a){var f=function(){"complete"===c.readyState&&b.apply(c,arguments)};a="readystatechange"}else var f=function(){b.apply(c,arguments)};return this.attachEvent("on"+a,f),e.push(f),d.push(b),this},sML.Polyfill.removeEventListener=function(a,b){for(var c=this["FunctionsOn"+a],d=this["XWrappersOn"+a],e=c.length,f=0;e>f&&c[f]!=b;f++);return"DOMContentLoaded"==a&&(a="readystatechange"),this.detachEvent("on"+a,d[f]),d[f]=c[f]=null,this},window.getComputedStyle=function(a){return a.currentStyle},window.addEventListener=function(a,b){return this.attachEvent("on"+a,b),this},window.removeEventListener=function(a,b){return this.detachEvent("on"+a,b),this},sML.Polyfill.extendElement(document),document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),sML.extendElements(document.documentElement))}),window.Event.prototype.stopPropagation=function(){this.cancelBubble=!0},window.Event.prototype.preventDefault=function(){this.returnValue=!1},Array.prototype.forEach=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=this.length,d=0;c>d;d++)a.call(b,this[d],d,this)},Array.prototype.map=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=[],d=this.length,e=0;d>e;e++)c.push(a.call(b,this[e],e,this));return c},Array.prototype.filter=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=[],d=this.length,e=0;d>e;e++)a.call(b,this[e],e,this)&&c.push(this[e]);return c},["section","article","nav","aside","header","footer","figure"].forEach(function(a){document.createElement(a)})),sML.extendElements=sML.Polyfill.extendElements,sML.Event={OnRead:{Done:!1,Functions:[]},OnLoad:{Done:!1,Functions:[]},add:function(a,b,c,d){return a.addEventListener(b,c,d?!0:!1),a},remove:function(a,b,c,d){return a.removeEventListener(b,c,d?!0:!1),a},stopPropagation:function(a){/*@cc_on @if (@_jscript_version<9) arguments[0]=event; @end @*/return a.stopPropagation()},preventDefault:function(a){/*@cc_on @if (@_jscript_version<9) arguments[0]=event; @end @*/return a.preventDefault()}},sML.addEventListener=sML.Event.add,sML.removeEventListener=sML.Event.remove,sML.stopPropagation=sML.Event.stopPropagation,sML.preventDefault=sML.Event.preventDefault,sML.Event.OnRead.doOnRead=sML.Event.OnLoad.doOnLoad=function(){if(!this.Done)for(this.Done=!0;this.Functions.length;)this.Functions.shift()()},sML.Event.OnRead.addEventListener=sML.Event.OnLoad.addEventListener=function(a){return this.Done?a():this.Functions.push(a)},sML.onread=sML.ready=function(a){return sML.Event.OnRead.addEventListener(a)},sML.onload=sML.done=function(a){return sML.Event.OnLoad.addEventListener(a)},document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),sML.Event.OnRead.doOnRead()},!1),window.addEventListener("load",function(){window.removeEventListener("load",arguments.callee,!1),sML.Event.OnRead.doOnRead(),sML.Event.OnLoad.doOnLoad()},!1),sML.Event.OnResizeFont=sML.onResizeFont=sML.onresizefont={RegularFunctions:[],onZoomInFunctions:[],onZoomOutFunctions:[],addEventListener:function(a,b){b&&b>0?this.onZoomInFunctions.push(a):b&&0>b?this.onZoomOutFunctions.push(a):this.RegularFunctions.push(a)},detect:function(a,b){if(!a)var a=document.body;if(!b)var b=200;this.checker=a,this.timer=setInterval(function(){var a=sML.Coord.getElementSize(sML.onResizeFont.checker).h;if(sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight!=a){var b=sML.onResizeFont.RegularFunctions;sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight<a?b=b.concat(sML.onResizeFont.onZoomInFunctions):sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight>a&&(b=b.concat(sML.onResizeFont.onZoomOutFunctions));for(var c=b.length,d=0;c>d;d++)b[d]()}sML.onResizeFont.prevHeight=a},b)},stopDetect:function(){this.timer&&clearTimeout(this.timer)}},sML.Chain=function(){this.Functions=arguments.length?sML.toArray(arguments):[],this.add=function(){for(var a=arguments.length,b=0;a>b;b++)this.Functions.push(arguments[b])},this.start=this.next=function(){var a=this.Functions.shift();"function"==typeof a&&a.apply(null,arguments)},this.skip=function(a){if("number"==typeof a)for(var b=0;a>b;b++)this.Functions.shift()}},sML.Timers={setTimeout:function(){var a=Array.prototype.shift.call(arguments),b=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,a),Array.prototype.unshift.call(arguments,b),setTimeout.apply(window,arguments)},setInterval:function(){var a=Array.prototype.shift.call(arguments),b=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,a),Array.prototype.unshift.call(arguments,b),setInterval.apply(window,arguments)}},sML.setTimeout=sML.Timers.setTimeout,sML.setInterval=sML.Timers.setInterval,sML.getElements=sML.getElementsBySelector=function(){for(var a=1,b=arguments.length;b>a;a++)arguments[0]+=","+arguments[a];return document.querySelectorAll(arguments[0])},sML.cloneObject=function(a){var b=function(){};return b.prototype=a,new b},sML.set=sML.edit=sML.setMembers=function(a,b,c){if(b)for(var d in b)a[d]=b[d];/*@cc_on @if (@_jscript_version<9) sML.Polyfill.extendElements(arguments[0]); @end @*/
return c&&sML.CSS.set(a,c),a},sML.create=sML.createElement=function(a,b,c){return sML.set(document.createElement(a),b,c)},sML.changeClass=sML.changeClassName=function(a,b){return b?a.className=b:a.removeAttribute("class"),a.className},sML.addClass=sML.addClassName=function(a,b){if("string"!=typeof b)return a.className;if(b=b.replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""),!b)return a.className;if(a.className){if((" "+a.className+" ").indexOf(" "+b+" ")>-1)return a.className;b=a.className+" "+b}return sML.changeClass(a,b)},sML.removeClass=sML.removeClassName=function(a,b){return a.className?"string"!=typeof b?a.className:(b=b.replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""))?(" "+a.className+" ").indexOf(" "+b+" ")<0?a.className:(b=(" "+a.className+" ").replace(" "+b+" "," ").replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""),sML.changeClass(a,b)):a.className:""},sML.replaceClass=sML.replaceClassName=function(a,b,c){return sML.removeClass(a,b),sML.addClass(a,c),a.className},sML.appendChildren=function(a,b){if(a.length)for(var c=a.length,d=0;c>d;d++)b.appendChild(a[d]);else b.appendChild(a);return a},sML.insertBefore=function(a,b){return b.parentNode.insertBefore(a,b),b.previousSibling},sML.insertAfter=function(a,b){return b.parentNode.insertBefore(a,b.nextSibling),b.nextSibling},sML.replaceElement=function(a,b){return b.parentNode.insertBefore(a,b),a=b.previousSibling,b.parentNode.removeChild(b),a},sML.removeElement=function(a){a.parentNode.removeChild(a)},sML.deleteElement=function(a){a.parentNode&&a.parentNode.removeChild(a),a.innerHTML="",a=null,delete a},sML.hatch=function(){for(var a="",b=arguments.length,c=0;b>c;c++)a+=arguments[c];var d=document.createElement("div"),e=document.createDocumentFragment(),f=function(){d.innerHTML=a;for(var b=d.childNodes.length,c=0;b>c;c++)e.appendChild(d.firstChild)};return sML.UA.InternetExplorer<9?(document.body.appendChild(d).display="none",f(),document.body.removeChild(d)):f(),e},sML.getContentDocument=function(a){return sML.UA.IE<8?a.contentWindow.document:a.contentDocument},sML.CSS=sML.S={Prefix:sML.UA.WK?"-webkit-":sML.UA.Ge?"-moz-":sML.UA.IE?"-ms-":sML.UA.Op?"-o-":"",TransitionEnd:sML.UA.WK?"webkitTransitionEnd":sML.UA.Ge?"transitionend":sML.UA.IE?"MSTransitionEnd":sML.UA.Op?"oTransitionEnd":"",AnimationEnd:sML.UA.WK?"webkitAnimationEnd":sML.UA.Ge?"animationend":sML.UA.IE?"MSAnimationEnd":sML.UA.Op?"oAnimationEnd":"",Catalogue:[],getSFO:function(a){for(var b=this.Catalogue.length,c=0;b>c;c++)if(this.Catalogue[c].Element==a)return this.Catalogue[c];return this.Catalogue[this.Catalogue.push({Element:a})-1]},getComputedStyle:function(a,b){var c=a.currentStyle||document.defaultView.getComputedStyle(a,b?b:"");return c},StyleSheets:[],getStyleSheet:function(a){if(sML.UA.IE<9)return a.styleSheets[a.styleSheets.length-1];for(var b=this.StyleSheets.length,c=0;b>c;c++)if(this.StyleSheets[c].StyleFor==a)return this.StyleSheets[c].StyleSheet;var d=a.createElement("style");return d.appendChild(a.createTextNode("")),a.getElementsByTagName("head")[0].appendChild(d),this.StyleSheets.push({StyleFor:a,StyleSheet:d.sheet}),d.sheet},addRule:function(a,b,c){if("function"==typeof b.join)b=b.join(" ");else if("object"==typeof b){var d=[];for(var e in b)d.push(e+": "+b[e]+";");b=d.join(" ")}var f=this.getStyleSheet(c?c:document);if(f){if(f.addRule){var g=f.rules.length;return f.addRule(a,b,g),g}if(f.insertRule)return f.insertRule(a+"{"+b+"}",f.cssRules.length)}return null},addRules:function(a,b){var c=[];if("function"==typeof a.join)for(var d=a.length/2,e=0;d>e;e++)c.push(this.addRule(a[2*e],a[2*e+1],b));else if("object"==typeof a)for(var f in a)c.push(this.addRule(f,a[f],b));return c},add:function(a,b){return this.addRules(a,b)},removeRule:function(a,b){var c=this.getStyleSheet(b?b:document);if(c){if(c.removeRule)c.removeRule(a);else{if(!c.deleteRule)return null;c.deleteRule(a)}return a}return null},removeRules:function(a,b){for(var c=a.length,d=0;c>d;d++)this.removeRule(a[d],b);return a},remove:function(a,b){return this.removeRules(a,b)},setProperty:function(a,b,c,d){return a&&b?(/^(animation|background(-s|S)ize|box|break|column|filter|flow|hyphens|region|shape|transform|transition|writing)/.test(b)?d=!0:"float"==b&&(b=sML.UA.IE?"styleFloat":"cssFloat"),d&&(a.style[this.Prefix+b]=c),a.style[b]=c,a):a},addTransitionEndListener:function(a,b){"function"==typeof b&&(a.sMLTransitionEndListener=b,sML.Event.add(a,this.TransitionEnd,a.sMLTransitionEndListener))},removeTransitionEndListener:function(a){"function"==typeof a.sMLTransitionEndListener&&(sML.Event.remove(a,this.TransitionEnd,a.sMLTransitionEndListener),delete a.sMLTransitionEndListener)},set:function(a,b,c){if(!a||"object"!=typeof b)return a;if(this.removeTransitionEndListener(a),"function"==typeof c&&this.addTransitionEndListener(a,c),!(b instanceof Array)){var d=[];for(var e in b)/^transition/.test(e)?this.setProperty(a,e,b[e]):d[d.push(e)]=b[e];b=d}if(b.length%2<1)for(var f=b.length/2,g=0;f>g;g++)this.setProperty(a,b[2*g],b[2*g+1]);return a},getRGB:function(a){for(var b=a.replace(/rgb\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),c=b.length,d=0;c>d;d++)b[d]=parseInt(b[d]);return b},getRGBA:function(a){for(var b=a.replace(/rgba?\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),c=b.length,d=0;c>d;d++)b[d]=parseInt(b[d]);return b[3]||(b[3]=1),b}},sML.style=sML.css=function(a,b,c){return sML.CSS.set(a,b,c)},sML.Easing="object"==typeof window.easing?window.easing:{},sML.Easing.linear=function(a){return a},sML.Easing.getEaser=function(a){return function(b){return b+a/100*(1-b)*b}},sML.Transition=sML.T={Catalogue:[],getSFO:function(a){for(var b=this.Catalogue.length,c=0;b>c;c++)if(this.Catalogue[c].Element==a)return this.Catalogue[c];return this.Catalogue[this.Catalogue.push({Element:a})-1]},begin:function(a,b,c){if(!b)var b={};if(!c)var c={};this.Element=a;var d=this.getSFO(a);d.Timer&&clearTimeout(d.Timer),d.Param={c:0,f:b.f?b.f:10,t:b.t?b.t:10,e:b.e?b.e:null,x:b.x?b.x:null},d.Functions={s:c.s?c.s:null,m:c.m?c.m:null,e:c.e?c.e:null,c:c.c?c.c:null},d.gN=d.getNext=function(a,b,c,e){var f=1,g=d.Param.c/d.Param.f;if(!c&&d.Param.e)var c=d.Param.e;if(!e&&d.Param.x)var e=d.Param.x;return f=c?0==e?g+c/(100*Math.PI)*Math.sin(Math.PI*g):e?(100+e*c)*g/(2*e*c*g+100-e*c):g+c/100*(1-g)*g:g,a+(b-a)*f},d.gC=d.getNextRGBA=function(a,b){var c=[],d=a.length,e=b.length;4==d&&3==e&&(b[3]=1);for(var f=0;d>f;f++)c[f]=Math.round(this.gN(a[f],b[f]));return c},d.Functions.s&&d.Functions.s.call(a,d),function(){d.Param.c++!=d.Param.f?(d.Functions.m&&d.Functions.m.call(a,d),d.Timer=setTimeout(arguments.callee,d.Param.t)):(d.Functions.e&&d.Functions.e.call(a,d),d.Functions.c&&d.Functions.c.call(a,d))}()}},sML.transition=function(){return sML.Transition.begin.apply(sML.Transition,arguments)},sML.Coord=sML.C={getXY:function(a,b){return{X:a,x:a,Y:b,y:b}},getWH:function(a,b){return{Width:a,W:a,w:a,Height:b,H:b,h:b}},getXYTRBLCMWH:function(a,b,c,d,e,f,g,h,i,j){return{X:a,x:a,Y:b,y:b,Top:c,top:c,T:c,t:c,Right:d,right:d,R:d,r:d,Bottom:e,bottom:e,B:e,b:e,Left:f,left:f,L:f,l:f,Center:g,center:g,C:g,c:g,Middle:h,middle:h,M:h,m:h,Width:i,width:i,W:i,w:i,Height:j,height:j,H:j,h:j}},getScreenSize:function(){return this.getWH(screen.availWidth,screen.availHeight)},getWindowSize:function(){return this.getWH(document.documentElement.clientWidth,document.documentElement.clientHeight)},getDocumentSize:function(){return this.getWH(document.documentElement.scrollWidth,document.documentElement.scrollHeight)},getElementSize:function(a){return this.getWH(a.offsetWidth,a.offsetHeight)},getWindowCoord:function(){return this.getXY(window.screenLeft||window.screenX,window.screenTop||window.screenY)},getScrollLimitCoord:function(a){var b=this.getDocumentSize(),c=this.getWindowSize();return this.getXY((b.W-c.W)*(a?-1:1),b.H-c.H)},getScrollCoord:function(){return this.getXY(window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,window.scrollY||window.pageYOffset||document.documentElement.scrollTop)},getElementCoord:function(a,b){var c=a.offsetLeft,d=a.offsetTop;for(b&&(c=c+a.offsetWidth-this.getWindowSize().W);a.offsetParent;)a=a.offsetParent,c+=a.offsetLeft,d+=a.offsetTop;return this.getXY(c,d)},getEventCoord:function(a){return a?this.getXY(a.pageX,a.pageY):this.getXY(0,0)},getCoord:function(a,b){if(b)return this.getCoord_RtL(a);if(a==screen)var c=this.getScreenSize(),d={X:0,Y:0},e={X:c.W,Y:c.H};else if(a==window)var c=this.getWindowSize(),d=this.getScrollCoord(),e={X:d.X+c.W,Y:d.Y+c.H};else if(a==document)var c=this.getDocumentSize(),d={X:0,Y:0},e={X:c.W,Y:c.H};else{if(!a.tagName)return{};var c=this.getElementSize(a),d=this.getElementCoord(a),e={X:d.X+c.W,Y:d.Y+c.H}}return this.getXYTRBLCMWH(d.X,d.Y,d.Y,e.X,e.Y,d.X,Math.round((d.X+e.X)/2),Math.round((d.Y+e.Y)/2),c.W,c.H)},getCoord_RtL:function(a){if(a==screen)var b=this.getScreenSize(),c={X:b.W,Y:0},d={X:0,Y:b.H};else if(a==window)var b=this.getWindowSize(),c=this.getScrollCoord(),d={X:c.X-b.W,Y:c.Y+b.H};else if(a==document)var b=this.getDocumentSize(),c={X:0,Y:0},d={X:b.W,Y:b.H};else{if(!a.tagName)return{};var b=this.getElementSize(a),c=this.getElementCoord(a,1),d={X:c.X-b.W,Y:c.Y+b.H}}return this.getXYTRBLCMWH(c.X,c.Y,c.Y,c.X,d.Y,d.X,Math.round((d.X+c.X)/2),Math.round((c.Y+d.Y)/2),b.W,b.H)},isInside:function(a,b,c){var d=this.getWindowSize();if(c)var e=this.getScrollCoord(),f={T:e.Y,R:e.X,B:e.Y+d.H,L:e.X-d.W};else var g=this.getScrollCoord(),f={T:g.Y,R:g.X+d.W,B:g.Y+d.H,L:g.X};if(a.tagName){var h=this.getElementSize(a);if(c)var i=this.getElementCoord(a,1),j={T:i.Y,R:i.X,B:i.Y+h.H,L:i.X-h.W};else var k=this.getElementCoord(a),j={T:k.Y,R:k.X+h.W,B:k.Y+h.H,L:k.X};j.C=(j.L+j.R)/2,j.M=(j.T+j.B)/2;var l=j.L>=f.L&&j.L<=f.R,m=j.C>=f.L&&j.C<=f.R,n=j.R>=f.L&&j.R<=f.R,o=j.T>=f.T&&j.T<=f.B,p=j.M>=f.T&&j.M<=f.B,q=j.B>=f.T&&j.B<=f.B,r=b?l&&n:l||m||n,s=b?o&&q:o||p||q}else if("object"==typeof a){if("number"==typeof a.X){var r=a.X>=f.L&&a.X<=f.R;if("number"!=typeof a.Y)return r}if("number"==typeof a.Y){var s=a.Y>=f.T&&a.Y<=f.B;if("number"!=typeof a.X)return s}}return r&&s}},sML.getCoord=function(){return sML.Coord.getCoord.apply(sML.Coord,arguments)},sML.Scroller={scrollTo_Legacy:function(a,b,c,d){b||(b={}),c||(c={}),"function"==typeof c&&(c={c:c}),this.SFO={};var e=b.rtl||b.rl||b.vt||b.vertical||/-rl$/.test(b.writingMode?b.writingMode:b["writing-mode"]?b["writing-mode"]:b.wm?b.wm:void 0);sML.Scroller.Timer&&clearTimeout(sML.Scroller.Timer),"number"==typeof a?a={Y:a}:a?a.tagName&&(a=sML.Coord.getElementCoord(a,e)):a={};var f=this.SFO,g=sML.Coord.getScrollCoord(),h=sML.Coord.getScrollLimitCoord(e);f.DC={X:"number"==typeof a.x?a.x:g.X,Y:"number"==typeof a.y?a.y:g.Y},e?(f.DC.X<h.X&&(f.DC.X=h.X),f.DC.X>0&&(f.DC.X=0)):(f.DC.X>h.x&&(f.DC.X=h.X),f.DC.X<0&&(f.DC.X=0)),f.DC.Y>h.Y&&(f.DC.Y=h.Y),f.DC.Y<0&&(f.DC.Y=0),f.Param={P:b.p?b.p:.25,T:b.t?b.t:20},f.Functions={start:c.s?c.s:null,middle:c.m?c.m:null,end:c.e?c.e:null,callback:c.c?c.c:null},d&&sML.Scroller.preventUserScrolling(),f.Functions.start&&f.Functions.start(f),function(){f.cC=sML.Coord.getScrollCoord(),f.mV={X:Math.floor((f.DC.X-f.cC.X)*f.Param.P),Y:Math.floor((f.DC.Y-f.cC.Y)*f.Param.P)},Math.abs(f.mV.X)>1||Math.abs(f.mV.Y)>1?(window.scrollBy(f.mV.X,f.mV.Y),f.Functions.middle&&f.Functions.middle(f),sML.Scroller.Timer=setTimeout(arguments.callee,f.Param.T)):(e?window.scrollBy(f.DC.X-f.cC.X,f.DC.Y-f.cC.Y):window.scrollTo(f.DC.X,f.DC.Y),d&&sML.Scroller.allowUserScrolling(),f.Functions.end&&f.Functions.end(f),f.Functions.callback&&f.Functions.callback(f))}(),d||sML.Scroller.addScrollCancelation()},scrollTo:function(a,b,c){{var d=sML.Coord.getScrollCoord();sML.Coord.getScrollLimitCoord()}if("number"==typeof a)a={X:d.X,Y:a};else if("object"!=typeof a||!a)return;"number"!=typeof a.X&&(a.X=d.X),"number"!=typeof a.Y&&(a.Y=d.Y),b||(b={}),("number"!=typeof b.Duration||b.Duration<0)&&(b.Duration=100);var e=sML.Easing.linear;if("function"==typeof b.Easing)var e=b.Easing;else if("string"==typeof b.Easing)var e=sML.Easing[b.Easing]?sML.Easing[b.Easing]:sML.Easing.linear;else if("number"==typeof b.Easing)var e=sML.Easing.getEaser(b.Easing);"function"==typeof c?c={callback:c}:"object"==typeof c&&c||(c={}),sML.Scroller.Timer&&clearTimeout(sML.Scroller.Timer),b.ForceScroll?sML.Scroller.preventUserScrolling():sML.Scroller.addScrollCancelation(),"function"==typeof c.start&&c.start(),function(a,b,c,d){var f=c.Duration?((new Date).getTime()-a.Time)/c.Duration:1;if(1>f){var g=e(f);window.scrollTo(Math.round(a.X+(b.X-a.X)*g),Math.round(a.Y+(b.Y-a.Y)*g)),"function"==typeof d.middle&&d.middle();var h=arguments.callee;sML.Scroller.Timer=setTimeout(function(){h(a,b,c,d)},10)}else window.scrollTo(b.X,b.Y),"function"==typeof d.end&&d.end(),"function"==typeof d.callback&&d.callback(),c.ForceScroll&&sML.Scroller.allowUserScrolling()}({X:d.X,Y:d.Y,Time:(new Date).getTime()},a,b,c)},addScrollCancelation:function(){sML.addEventListener(document,"mousedown",sML.Scroller.cancelScrolling),sML.addEventListener(document,"keydown",sML.Scroller.cancelScrolling),sML.addEventListener(document,"mousewheel",sML.Scroller.cancelScrolling),sML.addEventListener(document,"DOMMouseScroll",sML.Scroller.cancelScrolling)},cancelScrolling:function(){sML.removeEventListener(document,"mousedown",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"keydown",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"mousewheel",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"DOMMouseScroll",sML.Scroller.cancelScrolling)},preventUserScrolling:function(){sML.addEventListener(document,"mousedown",sML.preventDefault),sML.addEventListener(document,"keydown",sML.preventDefault),sML.addEventListener(document,"mousewheel",sML.preventDefault),sML.addEventListener(document,"DOMMouseScroll",sML.preventDefault)},allowUserScrolling:function(){sML.removeEventListener(document,"mousedown",sML.preventDefault),sML.removeEventListener(document,"keydown",sML.preventDefault),sML.removeEventListener(document,"mousewheel",sML.preventDefault),sML.removeEventListener(document,"DOMMouseScroll",sML.preventDefault)}},sML.scrollTo=function(a,b){return"object"==typeof a&&("number"==typeof a.x||"number"==typeof a.y)||"object"==typeof b&&("number"==typeof b.p||"number"==typeof b.t)||arguments.length>3?sML.Scroller.scrollTo_Legacy.apply(sML.Scroller,arguments):sML.Scroller.scrollTo.apply(sML.Scroller,arguments)},sML.Ajax=sML.A={open:function(a){try{var b=new XMLHttpRequest}catch(c){try{var b=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{var b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}}if(!b)return sML.log("sML.ShipBuilder could not find XHR.");if("object"!=typeof a||"string"!=typeof a.URI||"function"!=typeof a.onsuccess)return!1;a.Query||(a.Query=null),a.Auth||(a.Auth=["",""]),a.MimeType||(a.MimeType=null),a.onsuccess||(a.onsuccess=function(){}),a.onfailed||(a.onfailed=function(){sML.each(arguments,function(){sML.log(this+"")})}),a.ontimeout||(a.ontimeout=a.onfailed),a.Async!==!1&&(a.Async=!0),a.Method=a.Method&&/^POST$/i.test(a.Method)?"POST":"GET";var d="";if(a.Query)for(var e in a.Query)d+="&"+e+"="+encodeURIComponent(a.Query[e]);return d&&("GET"==a.method?(a.URI=a.URI+(a.URI.indexOf("?")>0?d:d.replace(/^&/,"?")),d=null):"POST"==a.Method&&(d=d.replace(/^&/,""))),b.sMLAjaxTimeout=0,b.sMLAjaxTimeoutTimer=setTimeout(function(){b.sMLAjaxTimeout=1,a.ontimeout("sML.AJAX.get Timeout: "+a.URI)},1e4),a.onstate4=function(c,d){b.sMLAjaxTimeout||(clearTimeout(b.sMLAjaxTimeoutTimer),200==b.status||0==b.status?a.onsuccess(c,d):a.onfailed("sML.AJAX.get Failed: ("+b.status+") "+URL),delete b)},b.onreadystatechange=function(){switch(this.readyState){case 4:return a.onstate4.call(this,this.responseText,this.responseXML)}},a.MimeType&&b.overrideMimeType(a.MimeType),b.open(a.Method,a.URI,a.Async,a.Auth[0],a.Auth[1]),"POST"==a.Method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(d),b}},sML.ajax=function(){var a={};if("object"==typeof arguments[0]){if(a=arguments[0],"string"!=typeof a.URI)return!1}else{if("string"!=typeof arguments[0])return!1;"object"==typeof arguments[1]&&(a=arguments[1]),a.URI=arguments[0]}if("function"!=typeof a.onsuccess){if("function"!=typeof arguments[1])return!1;a.onsuccess=arguments[1],"function"==typeof arguments[2]&&(a.onfailed=arguments[2]),"function"==typeof arguments[3]&&(a.ontimeout=arguments[3])}return sML.Ajax.open(a)},sML.Location=sML.Loc={RE:new RegExp("^((([a-z]+)://([^/\\?#]+))(/[^\\?#]*))(\\?[^\\?#]*)?(#[^#]*)?$"),getFile:function(a){return(a?a:location.href).replace(this.RE,"$1")},getOrigin:function(a){return(a?a:location.href).replace(this.RE,"$2")},getProtocol:function(a){return(a?a:location.href).replace(this.RE,"$3")},getHost:function(a){return(a?a:location.href).replace(this.RE,"$4")},getPathname:function(a){return(a?a:location.href).replace(this.RE,"$5")},getSearch:function(a){return(a?a:location.href).replace(this.RE,"$6")},getHash:function(a){return(a?a:location.href).replace(this.RE,"$7")},getDirectory:function(a){return this.getFile(a).replace(/\/[^\/]*$/,"")},getId:function(a){return this.getHash(a).replace("#","")},getQueries:function(a){var b=(a?a:location.href).split("?");if(2!=b.length)return{};for(var c={},d=b[1].replace(/#.*$/,"").split("&"),e=d.length,f=0;e>f;f++)if(d[f]){var g=d[f].split("=");g.length<2?g[1]=null:g.length>2&&(g[1]=d[f].replace(g[0]+"=","")),c[g[0]]=g[1]}return c},isIndexFile:function(a){return/index\.(x?html?|php|cgi|[ja]spx?)$/.test(this.getPathname(a))},isSameFile:function(a,b){return this.getFile(a)==(b?this.getOrigin(b):location.protocol+"//"+location.host+location.pathname)},isSameOrigin:function(a,b){return this.getOrigin(a)==(b?this.getOrigin(b):location.protocol+"//"+location.host)},isSameProtocol:function(a,b){return this.getProtocol(a)==(b?this.getProtocol(b):location.protocol)},isSameHost:function(a,b){return this.getHost(a)==(b?this.getHost(b):location.host)},isSameHash:function(a,b){return this.getHash(a)==(b?this.getHash(b):location.hash)},isSameDirectory:function(a,b){return this.getDirectory(a)==(b?this.getDirectory(b):(location.protocol+"//"+location.host+location.pathname).replace(/\/[^\/]*$/,""))},isSameId:function(a,b){return this.getId(a)==(b?this.getId(b):location.hash.replace("#",""))}},sML.getQueries=sML.Location.getQueries,sML.Cookies=sML.cookies={put:function(a,b,c){if(!c)var c=1;var d=new Date;return document.cookie=a+"="+b+"; path=/; expires="+d.toGMTString(d.setTime(d.getTime()+864e5*c)),document.cookie},del:function(a){var b=new Date;return document.cookie=a+"=%00; path=/; expires="+b.toGMTString(b.setTime(b.getTime()-864e5)),document.cookie},get:function(a){for(var b=document.cookie.split("; "),c="",d=b.length,e=0;d>e;e++)if(b[e].substr(0,a.length+1)==a+"="){c=b[e].substr(a.length+1,b[e].length);break}return c}},sML.CookieMonster={Cookies:{},set:function(a,b,c){return this.Cookies[a]||(this.Cookies[a]=this.get(a)),null==c?"undefined"!=typeof this.Cookies[a][b]&&delete this.Cookies[a][b]:this.Cookies[a][b]=c,this.Cookies[a]},put:function(a,b){if(!sML.getLength(this.Cookies[a]))return sML.Cookies.del(a),this.del(a);var c="";for(var d in this.Cookies[a])c+='"'+d+'":"'+this.Cookies[a][d]+'",';return c=encodeURIComponent("{"+c.replace(/\,$/,"")+"}"),sML.Cookies.put(a,c,b),this.Cookies},del:function(a){return this.Cookies[a]&&(sML.Cookies.del(a),delete this.Cookies[a]),this.Cookies},get:function(N,K){if(!this.Cookies[N]){var V="";try{V=eval("("+decodeURIComponent(sML.Cookies.get(N))+")")}catch(e){}this.Cookies[N]="object"==typeof V?V:{}}return K?"undefined"==typeof this.Cookies[N][K]?"":this.Cookies[N][K]:this.Cookies[N]}},sML.toArray=function(){for(var a=[],b=arguments.length,c=0;b>c;c++)if("undefined"==typeof arguments[c].length)a.push(arguments[c]);else for(var d=arguments[c].length,e=0;d>e;e++)a.push(arguments[c][e]);return a},sML.filter=function(a,b){if("function"!=typeof b)throw new TypeError;for(var c=[],d=a.length,e=0;d>e;e++)b.call(a[e],e,a)&&c.push(a[e]);return c},sML.foreach=function(a,b,c){for(var d=a.length,e=0;d>e&&b.call(c,a[e],e,a)!==!1;e++);return a},sML.each=function(a,b,c,d){for(var e=d?d+1:a.length,f=c?c:0;e>f&&b.call(a[f],f,a)!==!1;f++);return a},sML.firstOf=function(a){return a.length?a[0]:null},sML.lastOf=function(a){return a.length?a[a.length-1]:null},sML.Math={sum:function(){for(var a=0,b=arguments.length,c=0;b>c;c++){var d=0;"number"==typeof arguments[c]?d=arguments[c]:"string"==typeof arguments[c]&&(d=arguments[c].length),a+=d}return a},random:function(a,b){isNaN(a)&&isNaN(b)?(a=0,b=1):isNaN(a)?a=0:isNaN(b)&&(b=0);var c=Math.min(a,b),d=Math.max(a,b);return Math.floor(Math.random()*(d-c+1))+c}},sML.String={pad:function(a,b,c){if(a+="",a.length>=b)return a;"string"!=typeof c&&(c="0");for(var d="";d.length<b;)d+=c;return(d+a).slice(-b)},insertZeroWidthSpace:function(a){return a.replace(/(?=\w)/g,"&#x200B;")},replace:function(a,b){if(b.length%2)return this;for(var c=b.length/2,d=0;c>d;d++)a=a.replace(b[2*d],b[2*d+1]);return a}},sML.getLength=function(a){if("object"==typeof a){var b=0;for(var c in a)b++;return b}return"array"==typeof a?a.length:"string"==typeof a?a.length:"number"==typeof a?(""+a).length:null},sML.padZero=sML.zeroPadding=sML.String.padZero=sML.String.pad,sML.insertZeroWidthSpace=sML.String.insertZeroWidthSpace,sML.Range={getRange:function(a,b){if(!a)return null;b||(b=a.Start.Node.ownerDocument);var c=b.createRange();return c.setStart(a.Start.Node,"number"==typeof a.Start.Index?a.Start.Index:a.Start.Node.textContent.indexOf(a.Start.Text)),c.setEnd(a.End.Node,"number"==typeof a.End.Index?a.End.Index:a.End.Node.textContent.indexOf(a.End.Text)+a.End.Text.length),c},flat:function(a){return a.replace(/[\r\n]/g,"")},escape:function(a){return this.flat(a).replace(/([\(\)\{\}\[\]\,\.\-\+\*\?\!\:\^\$\/\\])/g,"\\$1")},distill:function(a,b,c){for(var d="",e=b;c>=e;e++)d+=a[e];return d},find:function(a,b){if(b||(b=document.body),"string"!=typeof a||!a||this.flat(b.textContent).indexOf(a)<0)return null;if(3==b.nodeType)return{Start:{Node:b,Text:a},End:{Node:b,Text:a}};for(var c=[],d=0,e=b.childNodes.length-1,f="",g={},h=0;e>=h;h++){if(this.flat(b.childNodes[h].textContent).indexOf(a)>=0)return this.find(a,b.childNodes[h]);c.push(b.childNodes[h].textContent)}for(f=this.distill(c,d+1,e);f&&this.flat(f).indexOf(a)>=0;)d++,f=this.distill(c,d+1,e);var i=b.childNodes[d],j=0,k=i.textContent.length-1,l="";for(f=this.distill(i.textContent,j,k);this.flat(f)&&!new RegExp("^"+this.escape(f)).test(a);)j++,f=this.distill(i.textContent,j,k);for(l=this.flat(f);3!=i.nodeType;)g=this.find(l,i),i=g.Start.Node,l=g.Start.Text;for(f=this.distill(c,d,e-1);f&&this.flat(f).indexOf(a)>=0;)e--,f=this.distill(c,d,e-1);var m=b.childNodes[e],n=0,o=m.textContent.length-1,p="";for(f=this.distill(m.textContent,n,o);this.flat(f)&&!new RegExp(this.escape(f)+"$").test(a);)o--,f=this.distill(m.textContent,n,o);for(p=this.flat(f);3!=m.nodeType;)g=this.find(p,m),m=g.End.Node,p=g.End.Text;return{Start:{Node:i,Text:l},End:{Node:m,Text:p}}}},sML.Selection={selectRange:function(a){if(!a)return null;var b=window.getSelection();return b.removeAllRanges(),b.addRange(a),a},getSelectedText:sML.UA.IE<9?function(){var a=""+document.selection.createRange().text;return a?a:""}:function(){var a=""+window.getSelection();return a?a:""}},sML.getSelection=function(){return sML.Selection.getSelectedText()},sML.select=function(a,b){return sML.Selection.selectRange(sML.Range.getRange(a,b))},sML.find=function(a,b){return sML.Selection.selectRange(sML.Range.getRange(sML.Range.find(a,b)))},sML.Fullscreen={request:function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.requestFullscreen?b("requestFullscreen"):a.requestFullScreen?b("requestFullScreen"):a.webkitRequestFullscreen?b("webkitRequestFullscreen"):a.webkitRequestFullScreen?b("webkitRequestFullScreen"):a.mozRequestFullscreen?b("mozRequestFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msRequestFullscreen?b("msRequestFullscreen"):function(){return!1}}(document.documentElement),exit:function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.exitFullscreen?b("exitFullscreen"):a.cencelFullScreen?b("cencelFullScreen"):a.webkitExitFullscreen?b("webkitExitFullscreen"):a.webkitCancelFullScreen?b("webkitCancelFullScreen"):a.mozExitFullscreen?b("mozExitFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msExitFullscreen?b("msExitFullscreen"):function(){return!1}}(document),getElement:function(a){var b=function(b){return function(c){return c||(c=a),c[b]}};return"undefined"!=typeof a.fullscreenElement?b("fullscreenElement"):"undefined"!=typeof a.fullScreenElement?b("fullScreenElement"):"undefined"!=typeof a.webkitFullscreenElement?b("webkitFullscreenElement"):"undefined"!=typeof a.webkitFullScreenElement?b("webkitFullScreenElement"):"undefined"!=typeof a.mozFullscreenElement?b("mozFullscreenElement"):"undefined"!=typeof a.mozFullScreenElement?b("mozFullScreenElement"):"undefined"!=typeof a.msFullscreenElement?b("msFullscreenElement"):function(){return null}}(document)},sML.requestFullscreen=sML.Fullscreen.request,sML.exitFullscreen=sML.Fullscreen.exit,sML.getFullscreenElement=sML.Fullscreen.getElement,window.addEventListener("unload",function(){sML=null,delete sML}),Bibi={/*!
 *
 *  # BiB/i (core)
 *
 *  - "EPUB Reader on Your Web Site."
 *  - (c) Satoru MATSUSHIMA - http://bibi.epub.link/
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 *  - 4 January 14 18:11:00 2015 +0900
 */
Version:"0.997.7",Build:20140104},A={},B={},C={},L={},O={},P={},R={},S={},X={},Bibi.plugin={},O.welcome=function(){O.log(1,"Welcome !"),O.HTML=document.getElementsByTagName("html")[0],O.Head=document.getElementsByTagName("head")[0],O.Body=document.getElementsByTagName("body")[0],O.Title=document.getElementsByTagName("title")[0],(sML.OS.iOS||sML.OS.Android)&&(O.SmartPhone=!0,O.setOrientation=function(){sML.removeClass(O.HTML,"orientation-"+(0==window.orientation?"landscape":"portrait")),sML.addClass(O.HTML,"orientation-"+(0==window.orientation?"portrait":"landscape"))},window.addEventListener("orientationchange",O.setOrientation),O.setOrientation()),sML.OS.iOS&&(O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-capable",content:"yes"})),O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black"})));var a=[];for(var b in sML.OS)sML.OS[b]&&a.push(b);for(var c in sML.UA)sML.UA[c]&&c.length>2&&"Flash"!=c&&a.push(c);O.HTML.className=a.join(" ")+" preparing",O.WindowEmbeded=function(){if(parent==window)return sML.addClass(O.HTML,"window-not-embeded"),0;sML.addClass(O.HTML,"window-embeded");try{return location.host==parent.location.host?1:-1}catch(a){return-1}}(),O.found(),O.open()},O.found=function(){C.weaveCartain(),R.Contents=O.Body.insertBefore(sML.create("div",{id:"epub-contents"}),C.Cartain)},O.open=function(){O.readExtra(),L.getBook(X.book)},L.sayLoading=function(a){sML.addClass(O.HTML,"wait-please"),sML.addClass(C.Cartain,"animate"),C.Cartain.Message.note(a?a:"Loading ...")},L.shutUpLoading=function(a){sML.removeClass(O.HTML,"wait-please"),sML.removeClass(C.Cartain,"animate"),C.Cartain.Message.note(a?a:"")},L.error=function(a){sML.removeClass(O.HTML,"wait-please"),sML.removeClass(C.Cartain,"animate"),O.log(0,a)},L.download=function(a,b){var c=new XMLHttpRequest;return b&&c.overrideMimeType(b),c.open("GET",a,!1),c.send(null),200!==c.status?L.error("XHR HTTP status: "+c.status+' "'+a+'"'):c},L.requestDocument=function(a){var b=/\.(xml|opf|ncx)$/i.test(a);if(!B.Zipped){var c=L.download("../bookshelf/"+B.Name+"/"+a);if(!b)var d=c.responseXML}if("undefined"==typeof d||!d){var e=B.Zipped?A.Files[a]:c.responseText,d=sML.create("object",{innerHTML:b?O.toBibiXML(e):e});b&&sML.each([d].concat(sML.toArray(d.getElementsByTagName("*"))),function(){this.getElementsByTagName=function(a){return this.querySelectorAll("bibi_"+a.replace(/:/g,"_"))}})}return d&&d.childNodes&&d.childNodes.length?d:L.error('Invalid Content. - "'+a+'"')},L.getBook=function(a){var b=function(a){a.size&&/\.epub$/i.test(a.name)?(X={book:"",bibi:{},pipi:{}},L.initialize(),L.sayLoading(),O.log(2,"Fetching EPUB..."),O.log(3,'"'+a.name+'"'),sML.edit(new FileReader,{onerror:function(){O.Body.style.opacity=1,C.Cartain.Message.note("Error. Something trouble...")},onload:function(){O.log(2,"Fetched."),L.preprocessEPUB(this.result),B.Name=a.name.replace(/\.epub$/i,""),B.Format="EPUB",B.Zipped=!0,L.readContainer()}}).readAsArrayBuffer(a)):C.Cartain.Message.note('Give me <span style="color:rgb(128,128,128);">EPUB</span>. Drop into this window.')};if(document.body.addEventListener("dragenter",function(a){a.preventDefault(),O.Body.style.opacity=.9},1),document.body.addEventListener("dragover",function(a){a.preventDefault(),O.Body.style.opacity=.9},1),document.body.addEventListener("dragleave",function(a){a.preventDefault(),O.Body.style.opacity=1},1),document.body.addEventListener("drop",function(a){a.preventDefault(),O.Body.style.opacity=1,b(a.dataTransfer.files[0])},1),"string"!=typeof a||!a||/\//.test(a))window.File?(C.Cartain.createCatcher({onchange:b}),C.Cartain.Message.note("Drop an EPUB file into this window, or click and select EPUB file.")):C.Cartain.Message.note("Tell me EPUB name via URL in address-bar.");else if(/\.epub$/i.test(a)){L.initialize();var c=function(){L.sayLoading(),O.log(2,"Fetching EPUB..."),O.log(3,'"'+a+'"');var b=L.download("../bookshelf/"+a,"text/plain;charset=x-user-defined").responseText;O.log(2,"Fetched."),L.preprocessEPUB(b),B.Name=a.replace(/\.epub$/i,""),B.Format="EPUB",B.Zipped=!0,L.readContainer()};X.pipi.wait?(C.Cartain.createPlayButton({onplay:function(){c(),delete X.pipi.wait}}),C.Cartain.Message.note("")):c()}else L.initialize(),L.sayLoading(),B.Name=a,B.Format="EPUB",L.readContainer()},L.initialize=function(){O.log(2,"Initializing BiB/i..."),L.FileDigit=3,B={Container:{Path:"META-INF/container.xml"},Package:{}},R.Contents.innerHTML="",R.Contents.style.opacity=0,R.CoverImage=null,R.Navigation=null;var a="string"==typeof X.bibi.preset&&X.bibi.preset&&!/\//.test(X.bibi.preset)?X.bibi.preset.replace(/(\.js)?$/,".js"):"default.js",b=function(){sML.each(["spread-gap","spread-margin-start","spread-margin-end","item-padding-left","item-padding-right","item-padding-top","item-padding-bottom"],function(){P[this]="number"!=typeof P[this]||P[this]<0?0:Math.round(P[this])}),P["spread-gap"]%2&&P["spread-gap"]++,X.bibi["book-display-mode"]&&/^(all|each)$/.test(X.bibi["book-display-mode"])&&(P["book-display-mode"]=X.bibi["book-display-mode"]),X.bibi["spread-layout-axis"]&&/^(horizontal|vertical)$/.test(X.bibi["spread-layout-axis"])&&(P["spread-layout-axis"]=X.bibi["spread-layout-axis"]),X.bibi["page-size-format"]&&/^(portrait|landscape|window)$/.test(X.bibi["page-size-format"])&&(P["page-size-format"]=X.bibi["page-size-format"]),"default.js"!==P.FileName&&O.updateSetting(P)};if(P.FileName||"default.js"!=a?P.FileName!=a&&(P.loaded=!1,document.getElementById("bibi-preset")&&sML.removeElement(document.getElementById("bibi-preset")),sML.insertAfter(sML.create("script",{id:"bibi-preset",onload:b}),document.getElementById("bibi-script")).src="../presets/"+a,P.FileName=a):(P.FileName="default.js",b()),O.log(3,"preset: "+a),P.plugins){var c,d,e;O.log(2,"Plugin Loading...");for(c in P.plugins)e=P.plugins[c],d=e.script,sML.insertAfter(sML.create("script"),document.getElementById("bibi-script")).src="../plugin/"+d,O.log(3,d);O.log(2,"Plugin Loaded.")}O.log(2,"Initialized.")},L.preprocessEPUB=function(a){O.log(2,"Preprocessing EPUB..."),A={Files:{},FileCount:{All:0,HTML:0,CSS:0,SVG:0,Bitmap:0,Font:0,Audio:0,Video:0,PDF:0},getDataURI:function(a){for(var b in O.ContentTypeList)if(O.ContentTypeList[b].test(a))return"data:"+b+";base64,"+(O.isBin(a)?btoa(A.Files[a]):Base64.encode(A.Files[a]));return""}},a=(new JSZip).load(a);for(var b in a.files)a.files[b]._data&&(A.FileCount.All++,/\.(x?html?)$/i.test(b)?A.FileCount.HTML++:/\.(css)$/i.test(b)?A.FileCount.CSS++:/\.(svg)$/i.test(b)?A.FileCount.SVG++:/\.(gif|jpe?g|png)$/i.test(b)?A.FileCount.Bitmap++:/\.(woff|otf|ttf)$/i.test(b)?A.FileCount.Font++:/\.(m4a|aac|mp3|ogg)$/i.test(b)?A.FileCount.Audio++:/\.(mp4|m4v|ogv|webm)$/i.test(b)?A.FileCount.Video++:/\.(pdf)$/i.test(b)&&A.FileCount.PDF++,A.Files[b]=O.isBin(b)?a.file(b).asBinary():Base64.btou(a.file(b).asText()));L.FileDigit=(A.FileCount.All+"").length,A.FileCount.All&&O.log(3,sML.String.padZero(A.FileCount.All,L.FileDigit)+" Files"),A.FileCount.HTML&&O.log(4,sML.String.padZero(A.FileCount.HTML,L.FileDigit)+" HTML"),A.FileCount.CSS&&O.log(4,sML.String.padZero(A.FileCount.CSS,L.FileDigit)+" CSS"),A.FileCount.SVG&&O.log(4,sML.String.padZero(A.FileCount.SVG,L.FileDigit)+" SVG"),A.FileCount.Bitmap&&O.log(4,sML.String.padZero(A.FileCount.Bitmap,L.FileDigit)+" Bitmap"),A.FileCount.Font&&O.log(4,sML.String.padZero(A.FileCount.Font,L.FileDigit)+" Font"),A.FileCount.Audio&&O.log(4,sML.String.padZero(A.FileCount.Audio,L.FileDigit)+" Audio"),A.FileCount.Video&&O.log(4,sML.String.padZero(A.FileCount.Video,L.FileDigit)+" Video"),A.FileCount.PDF&&O.log(4,sML.String.padZero(A.FileCount.PDF,L.FileDigit)+" PDF"),delete a;var c=replaceResourceRefferences=function(a,b,c){"function"!=typeof c&&(c=function(a){return new RegExp("<\\??[a-zA-Z1-6:-]+[^>]*? "+a+'[ 	]*=[ 	]*[\'"](?!(?:https?|data):)([^"]+?)[\'"]',"g")});var d=A.Files[a].replace(/[\r\n]/g,"\n").replace(/\r/g,"\n"),e=a.replace(/\/?[^\/]+$/,"");for(var f in b){var g=c(f),h=d.match(g);if(h){var i=new RegExp("."+b[f]+"$","i");sML.each(h,function(){var b=this.replace(g,"$1"),c=O.getPath(e,(/^(\.*\/+|#)/.test(b)?"":"./")+b),f=c.split("#"),h=f[0]?f[0]:a,j=f[1]?f[1]:"";i.test(h)&&A.Files[h]&&(d=d.replace(this,this.replace(b,A.getDataURI(h)+(j?"#"+j:""))))})}}return d},d={CSS:0,SVG:0,HTML:0};for(var e in A.Files)/\.css$/.test(e)&&(A.Files[e]=function(a){var b=arguments.callee;if(!A.Files[a])return"";var d=/@import[ \t]*(?:url\()?["']?(?!(?:https?|data):)(.+?)['"]?(?:\))?[ \t]*;/g,e=A.Files[a].match(d);return e&&sML.each(e,function(){var c=O.getPath(a.replace(/[^\/]+$/,""),this.replace(d,"$1"));A.Files[c]&&(A.Files[a]=A.Files[a].replace(this,b(c)))}),A.Files[a]=c(a,{url:"gif|png|jpe?g|svg|ttf|otf|woff"},function(){return/url\(["']?(?!(?:https?|data):)(.+?)['"]?\)/g}),A.Files[a]}(e),d.CSS++);d.CSS&&O.log(3,sML.String.padZero(d.CSS,L.FileDigit)+" CSS");for(var e in A.Files)/\.svg$/.test(e)&&(A.Files[e]=c(e,{href:"css",src:"gif|png|jpe?g|svg|js","xlink:href":"gif|png|jpe?g"}),d.SVG++);d.SVG&&O.log(3,sML.String.padZero(d.SVG,L.FileDigit)+" SVG");for(var e in A.Files)/\.x?html?$/.test(e)&&(A.Files[e]=c(e,{href:"css",src:"gif|png|jpe?g|svg|js","xlink:href":"gif|png|jpe?g"}));for(var e in A.Files)/\.x?html?$/.test(e)&&(A.Files[e]=c(e,{src:"x?html?"}),d.HTML++);d.HTML&&O.log(3,sML.String.padZero(d.HTML,L.FileDigit)+" HTML"),O.log(2,"Preprocessed.")},L.readContainer=function(){var a=L.requestDocument(B.Container.Path);O.log(2,"Reading Container XML..."),O.log(3,B.Container.Path),B.Package.Path=a.getElementsByTagName("rootfile")[0].getAttribute("full-path"),B.Package.Dir=B.Package.Path.replace(/\/?[^\/]+$/,""),O.log(2,"Read."),delete a,L.readPackageDocument()},L.readPackageDocument=function(){var a=L.requestDocument(B.Package.Path);O.log(2,"Reading Package Document..."),O.log(3,B.Package.Path);var b=a.getElementsByTagName("metadata")[0],c=a.getElementsByTagName("manifest")[0],d=a.getElementsByTagName("spine")[0],e=c.getElementsByTagName("item"),f=d.getElementsByTagName("itemref");if(e.length<=0)return O.log(0,'"'+B.Package.Path+'" has no <item> in <manifest>.');if(f.length<=0)return O.log(0,'"'+B.Package.Path+'" has no <itemref> in <spine>.');B.Package.Metadata={title:"",creator:"",publisher:"",language:"",titles:[],creators:[],publishers:[],languages:[]},B.Package.Manifest={items:{},nav:{},"cover-image":{},"toc-ncx":{}},B.Package.Spine={itemrefs:[]},sML.each(b.getElementsByTagName("meta"),function(){if(!this.getAttribute("refines")){if(this.getAttribute("property")){var a=this.getAttribute("property").replace(/^dcterms:/,"");/^(title|creator|publisher|language)$/.test(a)?B.Package.Metadata[a+"s"].push(this.textContent):B.Package.Metadata[a]||(B.Package.Metadata[a]=this.textContent)}this.getAttribute("name")&&this.getAttribute("content")&&(B.Package.Metadata[this.getAttribute("name")]=this.getAttribute("content"))}}),B.Package.Metadata.titles.length||sML.each(a.getElementsByTagName("dc:title"),function(){return B.Package.Metadata.titles.push(this.textContent),!1}),B.Package.Metadata.creators.length||sML.each(a.getElementsByTagName("dc:creator"),function(){B.Package.Metadata.creators.push(this.textContent)}),B.Package.Metadata.publishers.length||sML.each(a.getElementsByTagName("dc:publisher"),function(){B.Package.Metadata.publishers.push(this.textContent)}),B.Package.Metadata.languages.length||sML.each(a.getElementsByTagName("dc:language"),function(){B.Package.Metadata.languages.push(this.textContent)}),B.Package.Metadata.languages.length||(B.Package.Metadata.languages[0]="en"),B.Package.Metadata.title=B.Package.Metadata.titles.join(", "),B.Package.Metadata.creator=B.Package.Metadata.creators.join(", "),B.Package.Metadata.publisher=B.Package.Metadata.publishers.join(", "),B.Package.Metadata.language=B.Package.Metadata.languages.join(", "),B.Package.Metadata["rendition:layout"]||(B.Package.Metadata["rendition:layout"]="reflowable"),B.Package.Metadata["rendition:orientation"]||(B.Package.Metadata["rendition:orientation"]="auto"),B.Package.Metadata["rendition:spread"]||(B.Package.Metadata["rendition:spread"]="auto"),B.Package.Metadata.cover||(B.Package.Metadata.cover=""),O.getMetadata=function(){return B.Package.Metadata};var g=d.getAttribute("toc");sML.each(e,function(){var a={id:this.getAttribute("id")||"",href:this.getAttribute("href")||"","media-type":this.getAttribute("media-type")||"",properties:this.getAttribute("properties")||"",fallback:this.getAttribute("fallback")||""};a.id&&a.href&&(B.Package.Manifest.items[a.id]=a,function(b){/ nav /.test(b)&&(B.Package.Manifest.nav.Path=O.getPath(B.Package.Dir,a.href)),/ cover-image /.test(b)&&(B.Package.Manifest["cover-image"].Path=O.getPath(B.Package.Dir,a.href))}(" "+a.properties+" "),g&&a.id==g&&(B.Package.Manifest["toc-ncx"].Path=O.getPath(B.Package.Dir,a.href)))}),B.Package.Spine["page-progression-direction"]=d.getAttribute("page-progression-direction"),B.Package.Spine["page-progression-direction"]&&/^(ltr|rtl)$/.test(B.Package.Spine["page-progression-direction"])||(B.Package.Spine["page-progression-direction"]="default");var h=[/(rendition:layout)-(.+)/,/(rendition:orientation)-(.+)/,/(rendition:spread)-(.+)/,/(rendition:page-spread)-(.+)/,/(page-spread)-(.+)/];sML.each(f,function(){var a={idref:this.getAttribute("idref")||"",linear:this.getAttribute("linear")||"",properties:this.getAttribute("properties")||"","page-spread":"","rendition:layout":B.Package.Metadata["rendition:layout"],"rendition:orientation":B.Package.Metadata["rendition:orientation"],"rendition:spread":B.Package.Metadata["rendition:spread"]};a.properties=a.properties.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ").split(" "),sML.each(h,function(){var b=this;sML.each(a.properties,function(){return b.test(this)?(a[this.replace(b,"$1")]=this.replace(b,"$2").replace("rendition:",""),!1):void 0})}),a["rendition:page-spread"]&&(a["page-spread"]=a["rendition:page-spread"]),a["rendition:page-spread"]=a["page-spread"],a.viewport={content:null,width:null,height:null},a.viewBox={content:null,width:null,height:null},B.Package.Spine.itemrefs.push(a)});var i=[];B.Package.Metadata.title&&(i.push(B.Package.Metadata.title),O.log(3,"title: "+B.Package.Metadata.title)),B.Package.Metadata.creator&&(i.push(B.Package.Metadata.creator),O.log(3,"creator: "+B.Package.Metadata.creator)),B.Package.Metadata.publisher&&(i.push(B.Package.Metadata.publisher),O.log(3,"publisher: "+B.Package.Metadata.publisher)),i.length&&(O.Title.innerHTML="",O.Title.appendChild(document.createTextNode("BiB/i | "+i.join(" - ").replace(/&amp;?/gi,"&").replace(/&lt;?/gi,"<").replace(/&gt;?/gi,">")))),C.createPanel(),C.createSwitches(),O.log(2,"Read."),delete a,O.updateSetting({Reset:!0}),L.prepareSpine()},L.prepareSpine=function(){if(O.log(2,"Preparing Spine..."),R.Contents.innerHTML="",R.Spreads=[],R.Items=[],R.Pages=[],"rtl"==S.PPD)var a="right",b="left";else var a="left",b="right";sML.each(B.Package.Spine.itemrefs,function(c){var d=this,e=sML.create("iframe",{className:"item",id:"item-"+sML.String.padZero(c,L.FileDigit),scrolling:"no",allowtransparency:"true"});if(e.ItemRef=d,e.Path=O.getPath(B.Package.Dir,B.Package.Manifest.items[d.idref].href),e.Dir=e.Path.replace(/\/?[^\/]+$/,""),e.IsPrePaginated="pre-paginated"==d["rendition:layout"],"pre-paginated"==d["rendition:layout"]&&c){var f=R.Items[c-1];"pre-paginated"==f.ItemRef["rendition:layout"]&&f.ItemRef["page-spread"]==a&&d["page-spread"]==b&&(e.Pair=f,f.Pair=e)}if(e.Pair)var g=e.Pair.Spread;else{var h=R.Contents.appendChild(sML.create("div",{className:"spread-box"})),g=h.appendChild(sML.create("div",{className:"spread"}));"pre-paginated"==d["rendition:layout"]&&sML.addClass(h,"pre-paginated"),g.SpreadBox=h,g.Items=[],g.Pages=[],g.SpreadIndex=R.Spreads.length,R.Spreads.push(g)}var i=g.appendChild(sML.create("div",{className:"item-box"}));d["page-spread"]&&sML.addClass(i,"page-spread-"+d["page-spread"]),e.Spread=g,e.ItemBox=i,e.Pages=[],e.ItemIndexInSpread=g.Items.length,g.Items.push(e),e.ItemIndex=R.Items.length,R.Items.push(e)}),O.log(3,sML.String.padZero(R.Items.length,L.FileDigit)+" Items"),O.log(2,"Prepared."),L.loadCoverImage()},L.loadCoverImage=function(){if(!R.CoverImage){if(!B.Package.Manifest["cover-image"].Path)return O.log(2,"No Cover Image."),L.loadNavigation();R.CoverImage={Path:B.Package.Manifest["cover-image"].Path}}O.log(2,"Loading Cover Image..."),O.log(3,R.CoverImage.Path),sML.create("img",{onload:function(){sML.style(C.Cartain.Cover,{backgroundImage:"url("+this.src+")",opacity:1}),O.log(2,"Loaded."),L.loadNavigation()}}).src=function(){return B.Zipped?A.getDataURI(R.CoverImage.Path):"../bookshelf/"+B.Name+"/"+R.CoverImage.Path+"?cover-image"}()},L.loadNavigation=function(){if(B.Package.Manifest.nav.Path)R.Navigation={Path:B.Package.Manifest.nav.Path,Type:"NavigationDocument"};else{if(O.log(2,"No Navigation Document."),!B.Package.Manifest["toc-ncx"].Path)return O.log(2,"No TOC-NCX."),L.loadItems();R.Navigation={Path:B.Package.Manifest["toc-ncx"].Path,Type:"TOC-NCX"}}var a=L.requestDocument(R.Navigation.Path);if(O.log(2,"Loading Navigation..."),O.log(3,'"'+R.Navigation.Path+'"'),"NavigationDocument"==R.Navigation.Type)sML.each(a.querySelectorAll("nav"),function(){sML.each(this.querySelectorAll("*"),function(){this.removeAttribute("style")}),C.Panel.Navigation.Item.appendChild(this)});else{var b=a.getElementsByTagName("navMap")[0];sML.each(b.getElementsByTagName("navPoint"),function(){sML.insertBefore(sML.create("a",{href:this.getElementsByTagName("content")[0].getAttribute("src"),innerHTML:this.getElementsByTagName("text")[0].innerHTML}),this.getElementsByTagName("navLabel")[0]),sML.removeElement(this.getElementsByTagName("navLabel")[0]),sML.removeElement(this.getElementsByTagName("content")[0]);var a=sML.create("li");a.setAttribute("id",this.getAttribute("id")),a.setAttribute("playorder",this.getAttribute("playorder")),sML.insertBefore(a,this).appendChild(this),a.previousSibling&&a.previousSibling.tagName&&!/^a$/i.test(a.previousSibling.tagName)?a.previousSibling.appendChild(a):sML.insertBefore(sML.create("ul"),a).appendChild(a)}),C.Panel.Navigation.Item.innerHTML="<nav>"+b.innerHTML.replace(/<(bibi_)?navPoint( [^>]+)?>/gi,"").replace(/<\/(bibi_)?navPoint>/gi,"")+"</nav>"}L.postprocessLinkage(R.Navigation.Path,C.Panel.Navigation.Item,"InBibiNavigation"),O.log(2,"Loaded."),delete a,X.pipi.wait?(L.shutUpLoading(),C.Cartain.createPlayButton({onplay:function(){L.loadItems()}}),C.Cartain.Message.note("")):L.loadItems()},L.loadItems=function(){O.log(2,"Loading Items..."),sML.style(O.HTML,{backgroundImage:"none"}),sML.removeClass(O.HTML,"with-poster"),R.resetStage(),R.resetNavigation(),L.LoadedItems=0,R.ToRelayout=!1,L.listenResizingWhileLoading=function(){R.ToRelayout=!0},window.addEventListener("resize",L.listenResizingWhileLoading),sML.each(R.Items,function(){L.loadItem(this)}),setTimeout(function(){return L.LoadedItems<R.Items.length?setTimeout(arguments.callee,400):(document.body.style.display="",R.resetPages(),O.log(2,"Loaded."),void L.start())},10)},L.loadItem=function(a){var b=a.Path;if(a.Loaded=!1,/\.(x?html?)$/i.test(b))B.Zipped?(L.writeItemHTML(a,A.Files[b]),setTimeout(L.postprocessItem,10,a)):(a.src="../bookshelf/"+B.Name+"/"+b,a.onload=function(){setTimeout(L.postprocessItem,10,a)},a.ItemBox.appendChild(a));else if(/\.(svg)$/i.test(b))if(a.IsSVG=!0,B.Zipped)L.writeItemHTML(a,!1,"",A.Files[b].replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'));else{var c="../bookshelf/"+B.Name+"/"+b;L.writeItemHTML(a,!1,'<base href="'+c+'" />',L.download(c).responseText.replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'))}else/\.(gif|jpe?g|png)$/i.test(b)?(a.IsBitmap=!0,L.writeItemHTML(a,!1,"",'<img alt="" src="'+(B.Zipped?A.getDataURI(b):"../bookshelf/"+B.Name+"/"+b)+'" />')):/\.(pdf)$/i.test(b)&&(a.IsPDF=!0,L.writeItemHTML(a,!1,"",'<iframe     src="'+(B.Zipped?A.getDataURI(b):"../bookshelf/"+B.Name+"/"+b)+'" />'));O.log(3,sML.String.padZero(a.ItemIndex+1,L.FileDigit)+"/"+sML.String.padZero(B.Package.Spine.itemrefs.length,L.FileDigit)+" "+(b?b:"... Not Found."))},L.writeItemHTML=function(a,b,c,d){a.ItemBox.appendChild(a),a.contentDocument.open(),a.contentDocument.write(b?b:["<html>","<head>"+c+"</head>",'<body onload="parent.L.postprocessItem(parent.R.Items['+a.ItemIndex+"]); document.body.removeAttribute('onload'); return false;\">"+d+"</body>","</html>"].join("")),a.contentDocument.close()},L.postprocessItem=function(a){var b=a.ItemRef;a.HTML=sML.edit(a.contentDocument.getElementsByTagName("html")[0],{Item:a}),a.Head=sML.edit(a.contentDocument.getElementsByTagName("head")[0],{Item:a}),a.Body=sML.edit(a.contentDocument.getElementsByTagName("body")[0],{Item:a}),sML.each(a.Body.querySelectorAll("link"),function(){a.Head.appendChild(this)}),sML.UA.InternetExplorer<12&&sML.each(a.contentDocument.styleSheets,function(){for(var a=this.cssRules.length,b=0;a>b;b++){var c=this.cssRules[b];c.cssRules?arguments.callee.call(c):c.styleSheet?arguments.callee.call(c.styleSheet):/ (-(webkit|epub)-)?writing-mode: vertical-rl; /.test(c.cssText)?c.style.writingMode=/ direction: rtl; /.test(c.cssText)?"bt-rl":"tb-rl":/ (-(webkit|epub)-)?writing-mode: vertical-lr; /.test(c.cssText)?c.style.writingMode=/ direction: rtl; /.test(c.cssText)?"bt-lr":"tb-lr":/ (-(webkit|epub)-)?writing-mode: horizontal-tb; /.test(c.cssText)&&(c.style.writingMode=/ direction: rtl; /.test(c.cssText)?"rl-tb":"lr-tb")}}),S["epub-additional-stylesheet"]&&a.Head.appendChild(sML.create("link",{rel:"stylesheet",href:S["epub-additional-stylesheet"]})),S["epub-additional-script"]&&a.Head.appendChild(sML.create("script",{src:S["epub-additional-script"]})),a.StyleSheets=[],sML.CSS.add({html:"-webkit-text-size-adjust: none;"},a.contentDocument),sML.each(a.HTML.querySelectorAll("link, style"),function(){if(/^link$/i.test(this.tagName)){if(!/^(alternate )?stylesheet$/.test(this.rel))return;if(sML.UA.Safari&&"alternate stylesheet"==this.rel)return}a.StyleSheets.push(this)});var c=a.contentDocument.querySelectorAll("body>*");if(1==c.length&&(/^svg$/i.test(c[0].tagName)?a.SingleSVG=!0:/^img$/i.test(c[0].tagName)&&(a.SingleIMG=!0)),sML.each(a.Body.getElementsByTagName("img"),function(){this.Bibi={DefaultStyle:{margin:this.style.margin?this.style.margin:"",width:this.style.width?this.style.width:"",height:this.style.height?this.style.height:"","vertical-align":this.style.verticalAlign?this.style.verticalAlign:"","page-break-before":this.style.pageBreakBefore?this.style.pageBreakBefore:"","page-break-after":this.style.pageBreakAfter?this.style.pageBreakAfter:""}}}),sML.each(a.Head.getElementsByTagName("meta"),function(){if("viewport"==this.name&&(b.viewport.content=this.getAttribute("content"),b.viewport.content)){var a=1*b.viewport.content.replace(/^.*?width=([^\, ]+).*$/,"$1"),c=1*b.viewport.content.replace(/^.*?height=([^\, ]+).*$/,"$1");isNaN(a)||isNaN(c)||(b.viewport.width=a,b.viewport.height=c)}}),"pre-paginated"==b["rendition:layout"]&&!(b.viewport.width*b.viewport.height))if(a.SingleSVG){if(c[0].getAttribute("viewBox")){b.viewBox.content=c[0].getAttribute("viewBox");var d=b.viewBox.content.split(" ");if(4==d.length){var e=1*d[2]-1*d[0],f=1*d[3]-1*d[1];e&&f&&("100%"!=c[0].getAttribute("width")&&c[0].setAttribute("width","100%"),"100%"!=c[0].getAttribute("height")&&c[0].setAttribute("height","100%"),b.viewport.width=b.viewBox.width=e,b.viewport.height=b.viewBox.height=f)}}}else a.SingleIMG&&(b.viewport.width=parseInt(getComputedStyle(c[0]).width),b.viewport.height=parseInt(getComputedStyle(c[0]).height));L.postprocessLinkage(a.Path,a.Body),setTimeout(function(){return a.contentDocument.styleSheets.length<a.StyleSheets.length?setTimeout(arguments.callee,100):(a.ItemBox.style.background=a.contentDocument.defaultView.getComputedStyle(a.HTML).background,a.HTML.style.background="",a.style.background=a.contentDocument.defaultView.getComputedStyle(a.Body).background,a.Body.style.background="",R.ToRelayout||(R.resetItem(a),R.resetSpread(a.Spread)),a.contentWindow.addEventListener("keydown",C.listenKeys,!1),a.Loaded=!0,L.LoadedItems++,void O.showStatus("Loaded... ( "+L.LoadedItems+"/"+R.Items.length+" Items )"))},100)},L.postprocessLinkage=function(a,b,c){var d=a.replace(/\/?([^\/]+)$/,""),e=a.replace(/^.+?([^\/]+)$/,"$1");sML.each(b.getElementsByTagName("a"),function(b){var f=this;f.NavAIndex=b;var g=f.getAttribute("href");if(!g)return void(c&&(f.onclick=function(){return!1},sML.addClass(f,"bibi-navigation-inactive-link")));if(/^[a-zA-Z]+:/.test(g))return f.setAttribute("target","_blank");var h=O.getPath(d,(/^\.*\/+/.test(g)?"":"./")+(/^#/.test(g)?e:"")+g),i=h.split("#"),j=i[0]?i[0]:a,k=i[1]?i[1]:"";sML.each(R.Items,function(){var a=this;return j==a.Path?(f.setAttribute("data-bibi-original-href",g),f.setAttribute("href","bibi://"+B.Name+"/"+g),f.InBibiNavigation=c,f.Target={Item:a,Element:k?"#"+k:null},void(f.onclick=function(a){if(R.Started)if(this.InBibiNavigation){var b=this.Target;sML.stopPropagation(a),C.Panel.toggle(function(){R.focus(b)})}else R.focus(this.Target);else C.Cartain.PlayButton.play(this.Target,this.NavAIndex);return!1})):void 0}),k&&/^epubcfi\(.+\)$/.test(k)&&(f.setAttribute("data-bibi-original-href",g),f.setAttribute("href","bibi://"+B.Name+"/#"+k),f.InBibiNavigation=c,f.Target=O.getEPUBCFITarget(k),f.onclick=function(a){if(!this.Target)return!1;if(R.Started)if(this.InBibiNavigation){var b=this.Target;sML.stopPropagation(a),C.Panel.toggle(function(){R.focus(b)})}else R.focus(this.Target);else C.Cartain.PlayButton.play(this.Target,this.NavAIndex);return!1}),c&&"number"==typeof X.pipi.nav&&b==X.pipi.nav&&f.Target&&(X.bibi.To=f.Target)})},L.start=function(){C.createArrows(),L.shutUpLoading(),sML.removeClass(O.HTML,"preparing"),R.layout({Target:X.bibi.To?X.bibi.To:"head"}),window.removeEventListener("resize",L.listenResizingWhileLoading),delete L.listenResizingWhileLoading,sML.style(R.Contents,{transition:"opacity 0.75s ease-in-out",opacity:1}),sML.style(C.Switches.Panel,{display:"block"}),sML.style(C.Arrows,{opacity:1}),X.bibi.To&&sML.style(C.Arrows.Back,{opacity:1}),sML.style(C.Arrows.Forward,{opacity:1}),setTimeout(function(){C.Cartain.close(function(){setTimeout(function(){sML.each([C.Arrows.Back,C.Arrows.Forward],function(){sML.style(this,{opacity:""})})},500)})},1),L.shutUpLoading(),window.addEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),window.addEventListener("keydown",C.listenKeys,!1),R.Started=!0,Bibi.plugin.call("load"),O.log(1,"Enjoy!")},R.resetStage=function(){sML.OS.iOS&&sML.UA.Sa&&(O.Body.style.height="ttb"==S["spread-layout-direction"]?"100%":window.innerHeight+"px"),R.StageSize={Breadth:O.Body["client"+S.SIZE.B]-S["spread-margin-start"]-S["spread-margin-end"],Length:O.Body["client"+S.SIZE.L]-2*S["spread-gap"]},R.Contents.style["padding"+S.BASE.S]=R.Contents.style["padding"+S.BASE.E]=S["spread-margin-start"]+"px",R.Contents.style.background=S["book-background"]},R.getItemInnerText=function(a){var b="InnerText";return"undefined"!=typeof a.Body.innerText?b=a.Body.innerText:"undefined"!=typeof a.Body.textContent&&(b=a.Body.textContent),b.replace(/[\r\n\s\t ]/g,"")},R.resetItem=function(a){a.Reset=!1,a.Reflowable="pre-paginated"!=a.ItemRef["rendition:layout"]||!a.ItemRef.viewport[S.SIZE.b]||!a.ItemRef.viewport[S.SIZE.l],a.Reflowable?R.resetItem_Reflowable(a):R.resetItem_PrePagenated(a),a.Reset=!0},R.shock=function(a){var b=0,c=a.HTML,d=a.Body;b=c.clientWidth,b=c.clientHeight,b=c.scrollWidth,b=c.scrollHeight,b=c.offsetWidth,b=c.offsetHeight,b=d.clientWidth,b=d.clientHeight,b=d.scrollWidth,b=d.scrollHeight,b=d.offsetWidth,b=d.offsetHeight},R.resetItem_Reflowable=function(a){var b=(a.ItemIndex,a.ItemRef,a.ItemBox),c=a.Spread;a.Pages=[],a.scrolling="no";var d=R.getItemInnerText(a),e=!d&&1==a.Body.getElementsByTagName("img").length,f=!d&&1==a.Body.getElementsByTagName("iframe").length,g=R.StageSize.Breadth-(S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e]),h=R.StageSize.Length-(S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a]),i=g,j=h,k=S["item-padding-"+S.BASE.a]+S["spread-gap"]+S["item-padding-"+S.BASE.b];if("portrait"==S["page-size-format"]||"landscape"==S["page-size-format"]){var l=1.414/.96;("width"==S.SIZE.l&&"portrait"==S["page-size-format"]||"height"==S.SIZE.l&&"landscape"==S["page-size-format"])&&(l=1/l),j=Math.min(h,Math.floor(i*l))}b.style[S.SIZE.b]=i+(S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e])+"px",a.style["padding-"+S.BASE.b]=S["item-padding-"+S.BASE.b]+"px",a.style["padding-"+S.BASE.a]=S["item-padding-"+S.BASE.a]+"px",a.style["padding-"+S.BASE.s]=S["item-padding-"+S.BASE.s]+"px",a.style["padding-"+S.BASE.e]=S["item-padding-"+S.BASE.e]+"px",a.style[S.SIZE.b]=i+"px",a.style[S.SIZE.l]=j+"px",a.HTML.style[S.SIZE.b]=i+"px",a.HTML.style[S.SIZE.l]=j+"px",sML.style(a.HTML,{"column-width":"","column-gap":"","column-rule":""}),a.Columned=!1,a.ColumnBreadth=0,a.ColumnLength=0,a.ColumnGap=0;var m=sML.CSS.addRule("*","word-wrap: break-word;",a.contentDocument);if(f){var n=a.Body.getElementsByTagName("iframe")[0];n.style[S.SIZE.b]=n.style[S.SIZE.l]="100%"}if(e){if(S["fit-images"]&&(sML.style(a.HTML,{"transform-origin":"",transformOrigin:"",transform:""}),a.HTML["scroll"+S.SIZE.B]>i||a.HTML["scroll"+S.SIZE.L]>j)){var o=Math.floor(100*Math.min(i/a.HTML["scroll"+S.SIZE.B],j/a.HTML["scroll"+S.SIZE.L]))/100,p=("Width"==S.SIZE.B?i-a.HTML["scroll"+S.SIZE.B]:j-a.HTML["scroll"+S.SIZE.L])/2;sML.style(a.HTML,{"transform-origin":"50% 0",transformOrigin:"50% 0",transform:"scale("+o+") translateX("+p+"px)"})}}else{if(S["fit-images"]&&"in-single-image-only-item"!=S["fit-images"]&&sML.each(a.Body.getElementsByTagName("img"),function(){this.style.display=this.Bibi.DefaultStyle.display,this.style.verticalAlign=this.Bibi.DefaultStyle["vertical-align"],this.style.width=this.Bibi.DefaultStyle.width,this.style.height=this.Bibi.DefaultStyle.height;var b=Math.floor(Math.min(parseInt(getComputedStyle(a.Body)[S.SIZE.b]),i)),c=Math.floor(Math.min(parseInt(getComputedStyle(a.Body)[S.SIZE.l]),j));(parseInt(getComputedStyle(this)[S.SIZE.b])>=b||parseInt(getComputedStyle(this)[S.SIZE.l])>=c)&&("inline"==getComputedStyle(this).display&&(this.style.display="inline-block"),this.style.verticalAlign="top",parseInt(getComputedStyle(this)[S.SIZE.b])>=b&&(this.style[S.SIZE.b]=b+"px",this.style[S.SIZE.l]="auto"),parseInt(getComputedStyle(this)[S.SIZE.l])>=c&&(this.style[S.SIZE.l]=c+"px",this.style[S.SIZE.b]="auto"))}),("each"==S["book-display-mode"]||a.HTML["scroll"+S.SIZE.B]>i)&&(a.Columned=!0,a.ColumnBreadth=i,a.ColumnLength=j,a.ColumnGap=k,sML.style(a.HTML,{"column-width":a.ColumnLength+"px","column-gap":a.ColumnGap+"px","column-rule":""}),a.HTML["scroll"+S.SIZE.B]>i))return O.updateSetting({"spread-layout-axis":"vertical"==S["spread-layout-axis"]?"horizontal":"vertical"}),void(R.ToRelayout=!0);if(S["page-breaking"]){var q;q=a.Body["offset"+S.SIZE.B]<=i?["vertical"==S.SLA?"Top":"Left",window["inner"+S.SIZE.L],S.SIZE.L,S.SIZE.l,S.BASE.a]:["vertical"==S.SLA?"Left":"Top",i,S.SIZE.B,S.SIZE.b,S.BASE.e],sML.each(a.contentDocument.querySelectorAll("html>body *"),function(){var b=getComputedStyle(this);if("always"==b.pageBreakBefore||"always"==b.pageBreakAfter){this.BibiPageBreakerBefore&&(this.BibiPageBreakerBefore.style[q[3]]=""),this.BibiPageBreakerAfter&&(this.BibiPageBreakerAfter.style[q[3]]="");for(var c=this,d=c["offset"+q[0]],e=0;c.offsetParent;)c=c.offsetParent,d+=c["offset"+q[0]];"rtl"==S.SLD&&(d=window.innerWidth+-1*d-this["offset"+q[2]]),sML.log(q),sML.log(a.ItemIndex+": "+d),"always"==b.pageBreakBefore&&(this.BibiPageBreakerBefore||(this.BibiPageBreakerBefore=sML.insertBefore(sML.create("span",{className:"bibi-page-breaker-before"},{display:"block"}),this)),e=q[1]-d%q[1],e==q[1]&&(e=0),this.BibiPageBreakerBefore.style[q[3]]=e+"px"),"always"==b.pageBreakAfter&&(d+=e+this["offset"+q[2]],sML.log(a.ItemIndex+": "+d),this.style["margin-"+q[4]]=0,this.BibiPageBreakerAfter||(this.BibiPageBreakerAfter=sML.insertAfter(sML.create("span",{className:"bibi-page-breaker-after"},{display:"block"}),this)),e=q[1]-d%q[1],e==q[1]&&(e=0),this.BibiPageBreakerAfter.style[q[3]]=e+"px")
}})}}if(sML.CSS.removeRule(m,a.contentDocument),e)var r=j;else if(sML.UA.InternetExplorer>=10)var r=a.Body["client"+S.SIZE.L];else var r=a.Body["scroll"+S.SIZE.L];var s=Math.ceil((r+k)/(j+k));r=(j+k)*s-k,b.style[S.SIZE.l]=r+(S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a])+"px",a.style[S.SIZE.l]=r+"px";for(var t=0;s>t;t++){var u=b.appendChild(sML.create("span",{className:"page"}));u.style["padding"+S.BASE.B]=S["item-padding-"+S.BASE.b]+"px",u.style["padding"+S.BASE.A]=S["item-padding-"+S.BASE.a]+"px",u.style["padding"+S.BASE.S]=S["item-padding-"+S.BASE.s]+"px",u.style["padding"+S.BASE.E]=S["item-padding-"+S.BASE.e]+"px",u.style[S.SIZE.b]=i+"px",u.style[S.SIZE.l]=j+"px",u.style[S.BASE.b]=(j+k)*t+"px",u.Item=a,u.Spread=c,u.PageIndexInItem=a.Pages.length,a.Pages.push(u)}return a},R.resetItem_PrePagenated=function(a){var b=(a.ItemIndex,a.ItemRef),c=a.ItemBox,d=a.Spread;a.Pages=[],a.HTML.style.margin=a.HTML.style.padding=a.Body.style.margin=a.Body.style.padding=0;var e=R.StageSize.Breadth,f=R.StageSize.Length;a.style["padding"+S.BASE.B]=a.style["padding"+S.BASE.A]=a.style["padding"+S.BASE.S]=a.style["padding"+S.BASE.E]=0,"ttb"!=S["spread-layout-direction"]||"right"!=b["page-spread"]&&"left"!=b["page-spread"]||(e/=2);var g=Math.min(Math.min(b.viewport[S.SIZE.b],e)/b.viewport[S.SIZE.b],Math.min(b.viewport[S.SIZE.l],f)/b.viewport[S.SIZE.l]);f=Math.floor(b.viewport[S.SIZE.l]*g),e=Math.floor(b.viewport[S.SIZE.b]*(f/b.viewport[S.SIZE.l])),a.style[S.SIZE.l]=c.style[S.SIZE.l]=f+"px",a.style[S.SIZE.b]=c.style[S.SIZE.b]=e+"px",sML.style(a.HTML,{width:b.viewport.width+"px",height:b.viewport.height+"px","transform-origin":"0 0",transformOrigin:"0 0",transform:"scale("+g+")"});var h=c.appendChild(sML.create("span",{className:"page"}));return"right"==b["page-spread"]?h.style.right=0:h.style.left=0,h.style[S.SIZE.b]=e+"px",h.style[S.SIZE.l]=f+"px",h.Item=a,h.Spread=d,h.PageIndexInItem=a.Pages.length,a.Pages.push(h),a},R.resetSpread=function(a){var b=a.SpreadBox;b.style["margin"+S.BASE.B]=b.style["margin"+S.BASE.A]="",b.style["margin"+S.BASE.E]=b.style["margin"+S.BASE.S]="auto",b.style.padding="",1==a.Items.length?(b.style[S.SIZE.b]=a.style[S.SIZE.b]=a.Items[0].ItemBox.style[S.SIZE.b],b.style[S.SIZE.l]=a.style[S.SIZE.l]=a.Items[0].ItemBox.style[S.SIZE.l]):(b.style.width=a.style.width=Math.ceil(parseFloat(a.Items[0].ItemBox.style.width)+parseFloat(a.Items[1].ItemBox.style.width))+"px",b.style.height=a.style.height=Math.ceil(Math.max(parseFloat(a.Items[0].ItemBox.style.height),parseFloat(a.Items[1].ItemBox.style.height)))+"px"),a.style["border-radius"]=S["spread-border-radius"],a.style["box-shadow"]=S["spread-box-shadow"]},R.resetPages=function(){return R.Pages.forEach(function(a){a.parentNode.removeChild(a),delete a}),R.Pages=[],R.Spreads.forEach(function(a){a.Pages=[],a.Items.forEach(function(b){b.Pages.forEach(function(b){b.PageIndexInSpread=a.Pages.length,a.Pages.push(b),b.PageIndex=R.Pages.length,R.Pages.push(b)})})}),R.Pages},R.resetNavigation=function(){if(sML.style(C.Panel.Navigation.Item,{"float":""}),"rtl"==S.SLD){{C.Panel.Navigation.Item.scrollWidth-window.innerWidth}C.Panel.Navigation.Item.scrollWidth<window.innerWidth&&sML.style(C.Panel.Navigation.Item,{"float":"right"}),C.Panel.Navigation.ItemBox.scrollLeft=C.Panel.Navigation.ItemBox.scrollWidth-window.innerWidth}},R.layoutSpread=function(a){var b=a.SpreadBox,c=IsFootSpread=!1;"each"==S.BDM?c=IsFootSpread=!0:(c=0==a.SpreadIndex,IsFootSpread=a.SpreadIndex==R.Spreads.length-1),b.style.padding="";var d=PaddingAfter=b.offsetHeight<R.StageSize[S.SIZE.H]?Math.floor((R.StageSize[S.SIZE.H]-b.offsetHeight)/2):0;"vertical"==S.SLA?(1==a.Items.length&&"right"==a.Items[0].ItemRef["page-spread"]?b.style.paddingLeft=a.offsetWidth+"px":1==a.Items.length&&"left"==a.Items[0].ItemRef["page-spread"]&&(b.style.paddingRight=a.offsetWidth+"px"),d+=c?S["spread-gap"]:"reflowable"==B.Package.Metadata["rendition:layout"]?S["spread-gap"]:Math.floor(R.StageSize.Length/4-S["spread-gap"]),b.style.paddingTop=d?d+"px":"",b.style.paddingBottom=PaddingAfter?PaddingAfter+"px":""):(c?(d+=Math.floor((R.StageSize.Length-b["offset"+S.SIZE.L])/2),d<S["spread-gap"]&&(d=S["spread-gap"])):d+="reflowable"==B.Package.Metadata["rendition:layout"]?S["spread-gap"]:Math.floor(R.StageSize.Breadth/2),IsFootSpread&&(PaddingAfter+=Math.ceil((R.StageSize.Length-b["offset"+S.SIZE.L])/2),PaddingAfter<S["spread-gap"]&&(PaddingAfter=S["spread-gap"])),b.style["padding"+S.BASE.B]=d?d+"px":"",b.style["padding"+S.BASE.A]=PaddingAfter?PaddingAfter+"px":"")},R.layout=function(a){if(R.Layouted&&R.ToRelayout||O.log(2,"Laying Out..."),R.Layouted=!0,window.removeEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),a||(a={}),!a.Target){var b=R.getCurrentPages().Start;a.Target={ItemIndex:b.Item.ItemIndex,PageProgressInItem:b.PageIndexInItem/b.Item.Pages.length}}if(a.Setting&&O.updateSetting(a.Setting),a.Reset||R.ToRelayout){R.ToRelayout=!1,R.resetStage();for(var c=R.Spreads.length,d=0;c>d;d++){O.showStatus("Rendering... ( "+(d+1)+"/"+c+" Spreads )");for(var e=R.Spreads[d].Items.length,f=0;e>f;f++)if(R.resetItem(R.Spreads[d].Items[f]),R.ToRelayout)return R.layout(a);R.resetSpread(R.Spreads[d])}R.resetPages(),R.resetNavigation()}return a.Target=R.getTarget(a.Target),sML.each(R.Spreads,function(){R.layoutSpread(this,a.Target)}),R.focus(a.Target,{Duration:0,Easing:0}),O.log(3,"book-display-mode: "+S["book-display-mode"]),O.log(3,"spread-layout-axis: "+S["spread-layout-axis"]),O.log(3,"page-size-format: "+S["page-size-format"]),O.log(2,"Laid Out."),"function"==typeof doAfter&&doAfter(),window.addEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),Bibi.plugin.call("laidOut"),S},R.Relayouting=0,R.relayout=function(a,b){if(!R.Relayouting){R.Relayouting++;var c=R.getCurrentPages(),d=c.Start?{ItemIndex:c.Start.Item.ItemIndex,PageProgressInItem:c.Start.PageIndexInItem/c.Start.Item.Pages.length}:{ItemIndex:0,PageProgressInItem:0};setTimeout(function(){sML.style(R.Contents,{transition:"opacity 0.4s ease",opacity:0}),setTimeout(function(){R.layout({Target:d,Reset:!0,Setting:a}),R.Relayouting--,R.Relayouting||setTimeout(function(){sML.style(R.Contents,{transition:"opacity 0.4s ease",opacity:1})},100)},100)},"number"==typeof b&&b>=0?b:100)}},R.onresize=function(){R.relayout(null,sML.OS.iOS||sML.OS.Android?888:444)},R.changeBookDisplayMode=function(a){if(a!=S.BDM){var b={"book-display-mode":a};"each"==a?R.SpreadLayoutAxisBeforeChangeBookDisplayMode=S["spread-layout-axis"]:(b["spread-layout-axis"]=R.SpreadLayoutAxisBeforeChangeBookDisplayMode||S["spread-layout-axis"],R.SpreadLayoutAxisBeforeChangeBookDisplayMode=null),R.relayout(b)}},R.changeSpreadLayoutAxis=function(a){a!=S.SLA&&R.relayout({"spread-layout-axis":a})},R.changePageSizeFormat=function(a){a!=S.PSF&&R.relayout({"page-size-format":a})},R.getTarget=function(a){if("string"==typeof a?a={Edge:a}:"number"==typeof a&&(a={Item:R.Items[a]}),"object"!=typeof a||!a)return null;if(a.tagName&&(TargetElement=a,a={},"number"==typeof TargetElement.SpreadIndex?a.Item=TargetElement.Items[0]:"number"==typeof TargetElement.ItemIndex?a.Item=TargetElement:"number"==typeof TargetElement.PageIndex?a.Page=TargetElement:a.Element=TargetElement),"string"==typeof a.Edge){if("head"==a.Edge)return{Edge:"head",EdgeTRBL:"ttb"==S.SLD?"T":"rtl"==S.SLD?"R":"L",Item:R.Items[0],Page:R.Pages[0]};if("foot"==a.Edge)return{Edge:"foot",EdgeTRBL:"ttb"==S.SLD?"B":"rtl"==S.SLD?"L":"R",Item:R.Items[R.Items.length-1],Page:R.Pages[R.Pages.length-1]}}return a.Item||"number"!=typeof a.ItemIndex||(a.Item=R.Items[a.ItemIndex]),a.Element?(a.Element.tagName?a.Item=a.Element.ownerDocument.body.Item?a.Element.ownerDocument.body.Item:null:"string"==typeof a.Element&&a.Item&&(a.Element=a.Item.contentDocument.querySelector(a.Element),a.Element||delete a.Element),a.Page=a.Item.Pages[0]):a.Page?a.Item=a.Page.Item:"number"==typeof a.PageIndexInItem&&a.Item?a.Page=a.Item.Pages[a.PageIndexInItem]:"number"==typeof a.PageProgressInItem&&a.Item?a.Page=a.Item.Pages[Math.floor(a.Item.Pages.length*a.PageProgressInItem)]:"number"==typeof a.PageIndex&&(a.Page=R.Pages[a.PageIndex],a.Item=a.Page.Item),a.Item?(a.Page||(a.Page=a.Item.Pages[0]),a):null},R.getCurrentPages=function(){for(var a=sML.getCoord(window),b=[],c=null,d=0,e=a[S.SIZE.l]/2,f=R.Pages.length,g=0;f>g;g++)if("none"!=R.Pages[g].style.display){var h=sML.getCoord(R.Pages[g]),i=Math.min(a[S.BASE.a]/R.Scale*S.AXIS.PM,h[S.BASE.a]*S.AXIS.PM)-Math.max(a[S.BASE.b]/R.Scale*S.AXIS.PM,h[S.BASE.b]*S.AXIS.PM),j=Math.abs(a[S.BASE.b]/R.Scale+a[S.BASE.a]/R.Scale-(h[S.BASE.b]+h[S.BASE.a]));if(i=0>=i||!h[S.SIZE.l]||isNaN(i)?-1:Math.round(i/h[S.SIZE.l]*100),d>i){if(b.length)break}else i==d?b.push(R.Pages[g]):i>d&&(b[0]=R.Pages[g],d=i),e>j&&(c=R.Pages[g],e=j)}return{All:b,Start:b[0],Center:c,End:b[b.length-1]}},R.getPageGroup=function(a){a=R.getTarget(a);for(var b="a"==a.Side?-1:1,c=[],d=0,e=window["inner"+S.SIZE.L],f=a.Page.PageIndex;f>=0&&f<R.Pages.length&&(!a.Item.IsPrePaginated||R.Pages[f].Spread==a.Page.Spread)&&!(e-R.Pages[f]["offset"+S.SIZE.L]<0);f+=b)if(c.push(R.Pages[f]),"ttb"!=S.SLD||!R.Pages[f].Item.Pair||R.Pages[f].Item.Pair!=a.Page.Item){var g=0>f?S["spread-gap"]:0;e-=R.Pages[f]["offset"+S.SIZE.L]+g,d+=R.Pages[f]["offset"+S.SIZE.L]+g}var h=Math.floor(e/2),i=h;return"a"==a.Side&&(c.reverse(),i+=d-a.Page["offset"+S.SIZE.L]),{Page:a.Page,Pages:c,Length:d,MarginBeforeGroup:h,MarginBeforePage:i}},R.focus=function(a,b){var c=R.getTarget(a);if("object"!=typeof c||!c)return!1;if(c.Edge){var d=/^[TL]$/.test(c.EdgeTRBL)?0:O.Body["scroll"+S.SIZE.L]-O.Body["client"+S.SIZE.L];return sML.scrollTo("ttb"==S.SLD?{Y:d*R.Scale}:{X:d*R.Scale},b),!1}var e,d,f="ttb"==S.SLD?["Top","Left"]:["Left","Top"],g={Element:c.Element,TextNodeIndex:c.TextNodeIndex,TermStep:c.TermStep};if(c.Element){e=c.Item.Pages[0];for(var h=e["offset"+f[0]];e.offsetParent;)e=e.offsetParent,h+=e["offset"+f[0]];e=c.Element;for(var i=e["offset"+f[0]],j=e["offset"+f[1]];e.offsetParent;)e=e.offsetParent,i+=e["offset"+f[0]],j+=e["offset"+f[1]];sML.getCoord(c.Element)[S.BASE.s]>c.Item["offset"+S.SIZE.B]-S["item-padding-"+S.BASE.s]-S["item-padding-"+S.BASE.e]?(i=0==j?0:"rtl"!=S.PPD?(c.Item.ColumnLength+c.Item.ColumnGap)*Math.floor(j/c.Item.ColumnBreadth)-S["item-padding-"+S.BASE.b]:(c.Item.ColumnLength+c.Item.ColumnGap)*Math.ceil(j/c.Item.ColumnBreadth)-S["item-padding-"+S.BASE.a],"rtl"==S.SLD&&(i=c.Item.offsetWidth-i)):"rtl"==S.SLD&&(i+=c.Element.offsetWidth),h+=S["item-padding-"+f[0].toLowerCase()]+i,sML.each(c.Item.Pages,function(){var a=sML.getCoord(this)[S.BASE.b];return(h+8)*S.AXIS.PM<a*S.AXIS.PM?!1:void(d=a)}),"rtl"==S.SLD?d+=S["spread-gap"]:d-=S["spread-gap"],"number"==typeof g.TextNodeIndex&&R.pointTextLocation(g)}else{var k=R.getPageGroup(c);for(e=k.Pages[0],d=e["offset"+f[0]];e.offsetParent;)e=e.offsetParent,d+=e["offset"+f[0]];if("rtl"==S.SLD&&(d+=Math.floor(k.Pages[0]["offset"+S.SIZE.L])),window["inner"+S.SIZE.L]>k.Pages[0]["offset"+S.SIZE.L]){var l=Math.floor((window["inner"+S.SIZE.L]-k.Length)/2);l>0&&(d-=l*S.AXIS.PM)}}return"rtl"==S.SLD&&(d-=window["inner"+S.SIZE.L]),sML.scrollTo("ttb"==S.SLD?{Y:d*R.Scale}:{X:d*R.Scale},b),Bibi.plugin.call("focus"),!1},R.pointTextLocation=function(a){if("number"==typeof a.TextNodeIndex){var b=a.Element.childNodes[a.TextNodeIndex];if(b&&b.textContent){var c={Start:{Node:b,Index:0},End:{Node:b,Index:b.textContent.length}};if(a.TermStep)if(a.TermStep.Preceding||a.TermStep.Following){if(c.Start.Index=a.TermStep.Index,c.End.Index=a.TermStep.Index,a.TermStep.Preceding&&(c.Start.Index-=a.TermStep.Preceding.length),a.TermStep.Following&&(c.End.Index+=a.TermStep.Following.length),c.Start.Index<0||b.textContent.length<c.End.Index)return;if(b.textContent.substr(c.Start.Index,c.End.Index-c.Start.Index)!=a.TermStep.Preceding+a.TermStep.Following)return}else if(a.TermStep.Side&&"a"==a.TermStep.Side){for(c.Start.Node=b.parentNode.firstChild;c.Start.Node.childNodes.length;)c.Start.Node=c.Start.Node.firstChild;c.End.Index=a.TermStep.Index-1}else{for(c.Start.Index=a.TermStep.Index,c.End.Node=b.parentNode.lastChild;c.End.Node.childNodes.length;)c.End.Node=c.End.Node.lastChild;c.End.Index=c.End.Node.textContent.length}return sML.select(c)}}},R.page=function(a){-1!=a&&(a=1);var b=R.getCurrentPages(),c=0>a?b.Start:b.End,d=c.PageIndex+a;if(0>d)return R.focus({Edge:"head"});if(d>R.Pages.length-1)return R.focus({Edge:"foot"});var e=R.Pages[d];"vertical"==S.SLA&&e.Item.Pair&&c.Item.Pair==e.Item&&(d+=a>0?1:-1),"horizontal"==S.SLA&&e.Item.Pair&&window["inner"+S.SIZE.L]>2*e.Item[S.SIZE.L]&&(0>a&&0==e.PageIndexInSpread&&(e=e.Spread.Pages[1]),a>0&&1==e.PageIndexInSpread&&(e=e.Spread.Pages[0]));sML.getCoord(window);return R.focus({Page:e,Side:a>0?"b":"a"})},R.scroll=function(a){-1!=a&&(a=1);var b=sML.getCoord(window),c={};switch(S.SLD){case"ttb":c={Y:b.top+(R.StageSize.Length+S["spread-gap"])*a};break;case"ltr":c={X:b.left+(R.StageSize.Length+S["spread-gap"])*a};break;case"rtl":c={X:b.left+(R.StageSize.Length+S["spread-gap"])*a*-1}}return sML.scrollTo(c)},R.to=function(a){return R.focus(O.getBibitoTarget(a))},R.Scale=1,R.zoom=function(a){("number"!=typeof a||0>=a)&&(a=1),sML.style(R.Contents,{transition:"0.25s ease",transformOrigin:"rtl"==S.SLD?"100% 0":"0 0","transform-origin":"rtl"==S.SLD?"100% 0":"0 0"}),1==a?(O.HTML.style.overflow="",sML.style(R.Contents,{transform:""})):(sML.style(R.Contents,{transform:"scale("+a+")"}),O.HTML.style.overflow="auto"),R.Scale=a},C.weaveCartain=function(){C.Cartain=document.getElementById("bibi-cartain"),sML.edit(C.Cartain,{State:1,open:function(a){return 1==this.State?"function"==typeof a?a():this.State:(this.State=1,this.style.display="block",this.style.zIndex=100,sML.style(this,{transition:"0.5s ease-out",transform:"translate"+S.AXIS.XY+"(0)",opacity:.75},function(){"function"==typeof a&&a()}),this.State)},close:function(a){return 0==this.State?"function"==typeof a?a():this.State:(this.State=0,this.Message.style.opacity=0,sML.style(this,{transition:"0.5s ease-in",transform:"translate"+S.AXIS.XY+"("+-1*S.AXIS.PM*240+"%)",opacity:0},function(){sML.style(this,{transition:"none",transform:"translate"+S.AXIS.XY+"("+240*S.AXIS.PM+"%)"}),this.style.zIndex=1,this.style.display="none","function"==typeof a&&a()}),this.State)},toggle:function(a){return 0==this.State?this.open(a):this.close(a)}}),C.Cartain.Powered=C.Cartain.appendChild(sML.create("p",{id:"bibi-cartain-powered",innerHTML:O.getLogo({Linkify:!0})})),C.Cartain.Cover=C.Cartain.insertBefore(sML.create("div",{id:"bibi-cartain-cover"}),C.Cartain.Powered),C.Cartain.Mark=C.Cartain.insertBefore(sML.create("div",{id:"bibi-cartain-mark",className:"animate"}),C.Cartain.Powered),C.Cartain.Message=C.Cartain.insertBefore(sML.create("p",{id:"bibi-cartain-message",className:"animate"}),C.Cartain.Powered);for(var a=1;8>=a;a++)C.Cartain.Mark.appendChild(sML.create("span",{className:"dot"+a}));C.Cartain.createPlayButton=function(a){C.Cartain.PlayButton=C.Cartain.appendChild(sML.create("p",{id:"bibi-cartain-playbutton",title:(sML.OS.iOS||sML.OS.Android?"Tap":"Click")+" to Open",play:function(b,c){if(O.SmartPhone){var d=location.href.replace(/&wait=[^&]+/g,"");return"number"==typeof c&&(d=[d,"pipi(nav:"+c+")"].join(/#/.test(d)?",":"#")),window.open(d)}b&&(X.bibi.To=b),L.sayLoading(),this.onclick=function(){return!1},sML.style(this,{opacity:0,cursor:"default"}),a.onplay()},onclick:function(a){this.play(),sML.stopPropagation(a)}})),C.Cartain.PlayButton.innerHTML='<span class="non-visual">'+C.Cartain.PlayButton.title+" to Open</span>"},C.Cartain.createCatcher=function(a){C.Cartain.Catcher=C.Cartain.appendChild(sML.create("p",{id:"bibi-cartain-catcher",title:"Drop me an EPUB! or Click me!",onclick:function(){this.Input||(this.Input=this.appendChild(sML.create("input",{type:"file",onchange:function(b){a.onchange(b.target.files[0]),C.Cartain.Catcher.style.opacity=0}}))),this.Input.click()}}))},C.Cartain.Message.note=function(a){return C.Cartain.Message.innerHTML=a,a}},C.createPanel=function(){if(C.Panel?C.Panel.innerHTML="":C.Panel=O.Body.appendChild(sML.create("div",{id:"bibi-panel",State:0,open:function(a){return 1==this.State?"function"==typeof a?a():this.State:(this.State=1,C.Switches.Panel.toggleState(this.State),sML.style(C.Panel,{transition:"0.2s ease-in"}),sML.style(R.Contents,{transition:"0.2s ease-in"}),sML.addClass(O.HTML,"panel-opened"),setTimeout(a,250),Bibi.plugin.call("openPanel"),this.State)},close:function(a){return 0==this.State?"function"==typeof a?a():this.State:(this.State=0,C.Switches.Panel.toggleState(this.State),sML.style(C.Panel,{transition:"0.2s ease-out"}),sML.style(R.Contents,{transition:"0.2s ease-out"}),sML.removeClass(O.HTML,"panel-opened"),setTimeout(a,250),Bibi.plugin.call("closePanel"),this.State)},toggle:function(a){return 0==this.State?this.open(a):this.close(a)}})),C.Panel.Misc=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-misc",innerHTML:O.getLogo({Linkify:!0})})),C.Panel.Navigation=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-navigation"})),C.Panel.Navigation.ItemBox=C.Panel.Navigation.appendChild(sML.create("div",{id:"bibi-panel-navigation-item-box",onclick:function(){C.Panel.toggle()}})),C.Panel.Navigation.Item=C.Panel.Navigation.ItemBox.appendChild(sML.create("div",{id:"bibi-panel-navigation-item"})),C.Panel.Menu=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-menu"})),!(sML.UA.InternetExplorer<12||sML.UA.Opera<15||sML.UA.Gecko)){var a={};a.Item='<span class="bibi-shape bibi-shape-item"></span>',a.Spread='<span class="bibi-shape bibi-shape-spread">'+a.Item+a.Item+"</span>",a.Spreads='<span class="bibi-shape bibi-shape-spreads">'+a.Spread+a.Spread+a.Spread+"</span>",a.SpreadsV='<span class="bibi-shape bibi-shape-spreads-vertical">'+a.Spread+a.Spread+a.Spread+"</span>",a.SpreadsH='<span class="bibi-shape bibi-shape-spreads-horizontal">'+a.Spread+a.Spread+a.Spread+"</span>",C.Panel.Menu["book-display-mode"]=C.Panel.Menu.appendChild(sML.create("ul",{id:"book-display-mode"})),C.Panel.Menu["book-display-mode"].Buttons={all:C.Panel.Menu["book-display-mode"].appendChild(sML.create("li",{className:"display-all",innerHTML:'<span class="bibi-icon bibi-icon-all" title="Display All">'+a.Spreads+"</span>",onclick:function(){C.Panel.toggle(function(){R.changeBookDisplayMode("all")})}})),each:C.Panel.Menu["book-display-mode"].appendChild(sML.create("li",{className:"display-each",innerHTML:'<span class="bibi-icon bibi-icon-each" title="Display Each">'+a.Spread+"</span>",onclick:function(){C.Panel.toggle(function(){R.changeBookDisplayMode("each")})}}))},C.Panel.Menu["spread-layout-axis"]=C.Panel.Menu.appendChild(sML.create("ul",{id:"spread-layout-axis"})),C.Panel.Menu["spread-layout-axis"].Buttons={vertical:C.Panel.Menu["spread-layout-axis"].appendChild(sML.create("li",{className:"layout-vertical",innerHTML:'<span class="bibi-icon bibi-icon-vertical" title="Layout Vertically">'+a.SpreadsV+"</span>",onclick:function(){C.Panel.toggle(function(){R.changeSpreadLayoutAxis("vertical")})}})),horizontal:C.Panel.Menu["spread-layout-axis"].appendChild(sML.create("li",{className:"layout-horizontal",innerHTML:'<span class="bibi-icon bibi-icon-horizontal" title="Layout Horizontally">'+a.SpreadsH+"</span>",onclick:function(){C.Panel.toggle(function(){R.changeSpreadLayoutAxis("horizontal")})}}))},C.Panel.Menu["plugin-menus"]=C.Panel.Menu.appendChild(sML.create("ul",{id:"plugin-menus"})),sML.each(C.Panel.Menu.getElementsByClassName("bibi-icon"),function(){this.innerHTML='<span class="non-visual">'+this.title+"</span>"+this.innerHTML})}},C.createSwitches=function(){C.Switches?C.Switches.innerHTML="":C.Switches=O.Body.appendChild(sML.create("div",{id:"bibi-switches"},{transition:"opacity 0.75s linear"}));var a=function(a){this.State="number"==typeof a?a:Math.abs(this.State-1);var b=B.Package.Metadata.languages[0].split("-")[0],c=(b&&/^(ja)$/.test(b)?this.Labels[this.State][b]+" / ":"")+this.Labels[this.State].en;return this.title=c,this.innerHTML='<span class="non-visual">'+c+"</span>",this.State};C.Switches.Panel=C.Switches.appendChild(sML.create("span",{className:"bibi-switch bibi-switch-panel",State:0,Labels:[{ja:"メニューを開く",en:"Open Menu"},{ja:"メニューを閉じる",en:"Close Menu"}],toggleState:a,onclick:function(){return C.Panel.toggle()}})),function(){return document.body.requestFullscreen||document.body.requestFullScreen?!0:document.body.webkitRequestFullscreen||document.body.webkitRequestFullScreen?!0:document.body.mozRequestFullscreen||document.body.mozRequestFullScreen?!0:document.body.msRequestFullscreen?!0:!1}()?(sML.addClass(O.HTML,"fullscreen-enabled"),O.WindowEmbeded||(C.Switches.Fullscreen=C.Switches.appendChild(sML.create("span",{className:"bibi-switch bibi-switch-fullscreen",State:0,Labels:[{ja:"フルスクリーンモードを開始",en:"Enter Fullscreen"},{ja:"フルスクリーンモードを終了",en:"Exit Fullscreen"}],toggleState:a,enter:function(){sML.requestFullscreen(O.HTML),this.toggleState(1)},exit:function(){sML.exitFullscreen(),this.toggleState(0)},toggle:function(){return sML.getFullscreenElement()?this.exit():this.enter()},onclick:function(){return this.toggle()}})))):sML.addClass(O.HTML,"fullscreen-not-enabled"),sML.each(C.Switches.getElementsByClassName("bibi-switch"),function(){this.toggleState(0)})},C.createArrows=function(){C.Arrows?C.Arrows.innerHTML="":C.Arrows=O.Body.appendChild(sML.create("div",{id:"bibi-arrows"},{transition:"opacity 0.75s linear",opacity:0})),C.Arrows.Back=C.Arrows.appendChild(sML.create("div",{title:"Back",className:"bibi-arrow",id:"bibi-arrow-back",onclick:function(){Bibi.plugin.call("back"),R.page(-1)}})),C.Arrows.Forward=C.Arrows.appendChild(sML.create("div",{title:"Forward",className:"bibi-arrow",id:"bibi-arrow-forward",onclick:function(){Bibi.plugin.call("forward"),R.page(1)}})),sML.each([C.Arrows.Back,C.Arrows.Forward],function(){this.addEventListener("mouseover",function(){this.clickedTimer&&clearTimeout(this.clickedTimer),sML.addClass(this,"shown")}),this.addEventListener("mouseout",function(){sML.removeClass(this,"shown")}),this.addEventListener("click",function(){sML.addClass(this,"shown");var a=this;this.clickedTimer&&clearTimeout(this.clickedTimer),this.clickedTimer=setTimeout(function(){sML.removeClass(a,"shown")},500)})})},C.listenKeys=function(a){if(R.Started){var b=parent!=window&&parent.Bibi?parent:window;b.C.KeyCode=a.keyCode;var c=null;if("ttb"==S["spread-layout-direction"])switch(a.keyCode){case 37:c=0;break;case 38:c=-1;break;case 39:c=0;break;case 40:c=1}else if("ltr"==S["spread-layout-direction"])switch(a.keyCode){case 37:c=-1;break;case 38:c=0;break;case 39:c=1;break;case 40:c=0}else if("rtl"==S["spread-layout-direction"])switch(a.keyCode){case 37:c=1;break;case 38:c=0;break;case 39:c=-1;break;case 40:c=0}switch(c){case-1:return b.R.page(-1);case 1:return b.R.page(1);case 0:return b.C.Panel.toggle()}}},O.updateSetting=function(a){if("object"!=typeof a)return S;var b=S.BDM,c=S.SLA,d=S.SLD,e=S.PSF,f=S.PPD;if(a.Reset){for(var g in S)delete S[g];for(var g in P)S[g]=P[g];S["page-progression-direction"]=B.Package.Spine["page-progression-direction"],"default"==S["page-progression-direction"]&&(S["page-progression-direction"]=P["page-progression-direction"]),delete a.Reset}for(var g in a)S[g]=a[g];return(sML.UA.InternetExplorer<11||sML.UA.Opera<15)&&(S["book-display-mode"]="all",S["spread-layout-axis"]="vertical",S["page-size-format"]="window"),sML.UA.Gecko&&(S["book-display-mode"]="all",S["spread-layout-axis"]="vertical",S["page-size-format"]="window"),"auto"==S["spread-layout-axis"]&&(S["spread-layout-axis"]=B.Package.Spine["page-progression-direction"]),"default"==S["spread-layout-axis"]&&(S["spread-layout-axis"]="pre-paginated"==B.Package.Metadata["rendition:layout"]?S["page-progression-direction"]:"vertical"),"vertical"!=S["spread-layout-axis"]&&(S["spread-layout-axis"]="horizontal"),"vertical"==S["spread-layout-axis"]&&(S["spread-layout-direction"]="ttb"),"horizontal"==S["spread-layout-axis"]&&(S["spread-layout-direction"]="rtl"!=S["page-progression-direction"]?"ltr":"rtl"),S.BDM=S["book-display-mode"],S.SLA=S["spread-layout-axis"],S.SLD=S["spread-layout-direction"],S.PPD=S["page-progression-direction"],S.PSF=S["page-size-format"],"vertical"==S.SLA?(S.SIZE={b:"width",B:"Width",l:"height",L:"Height",w:"breadth",W:"Breadth",h:"length",H:"Length"},S.AXIS={XY:"Y",YX:"X",PM:1},S.BASE="ltr"==S.PPD?{b:"top",B:"Top",a:"bottom",A:"Bottom",s:"left",S:"Left",e:"right",E:"Right",c:"center",m:"middle"}:{b:"top",B:"Top",a:"bottom",A:"Bottom",s:"right",S:"Right",e:"left",E:"Left",c:"center",m:"middle"}):(S.SIZE={b:"height",B:"Height",l:"width",L:"Width",w:"length",W:"Length",h:"breadth",H:"Breadth"},"ltr"==S.PPD?(S.AXIS={XY:"X",YX:"Y",PM:1},S.BASE={b:"left",B:"Left",a:"right",A:"Right",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"}):(S.AXIS={XY:"X",YX:"Y",PM:-1},S.BASE={b:"right",B:"Right",a:"left",A:"Left",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"})),b!=S.BDM&&sML.replaceClass(O.HTML,"display-"+b,"display-"+S.BDM),c!=S.SLA&&sML.replaceClass(O.HTML,"spread-"+c,"spread-"+S.SLA),d!=S.SLD&&sML.replaceClass(O.HTML,"spread-"+d,"spread-"+S.SLD),e!=S.PSF&&sML.replaceClass(O.HTML,"page-"+e,"page-"+S.PSF),f!=S.PPD&&sML.replaceClass(O.HTML,"page-"+f,"page-"+S.PPD),S},O.readExtra=function(){if(O.EPUBCFI=BibiEPUBCFI,X=O.parseHash(),X.book=sML.getQueries().book,history.replaceState&&history.replaceState(null,null,location.href.replace(/[\,#]pipi\([^\)]*\)$/g,"")),!X.book){var a=location.pathname.split("/"),b=a[a.length-1];""!=b&&"index.html"!=b&&(X.book=b.replace(/\.html$/,""))}X.bibi?(X.bibi={Data:X.bibi},sML.each(X.bibi.Data.replace(" ","").split(","),function(){var a=this.split(":");if(a[0]){if(!a[1])switch(a[0]){case"all":case"each":a[1]=a[0],a[0]="book-display-mode";break;case"horizontal":case"vertical":a[1]=a[0],a[0]="spread-layout-axis";break;case"window":case"portrait":case"landscape":a[1]=a[0],a[0]="page-size-format";break;default:return}switch(a[0]){case"preset":a[1]=a[1].replace(/(\.js)?$/,".js");break;case"to":a[1]=O.getBibitoTarget(a[1]);break;case"book-display-mode":case"spread-layout-axis":case"page-size-format":break;default:return}X.bibi[a[0]]=a[1]}})):X.bibi={},X.pipi?(X.pipi={Data:X.pipi},sML.each(X.pipi.Data.replace(" ","").split(","),function(){var a=this.split(":");if(a[0]){if(!a[1])switch(a[0]){case"wait":a[1]=!0,a[0]="wait";break;case"autostart":a[1]=!0,a[0]="autostart";break;default:return}switch(a[0]){case"wait":case"autostart":break;case"poster":a[1]=decodeURIComponent(a[1].replace("_BibiKakkoClose_",")").replace("_BibiKakkoOpen_","("));break;case"nav":a[1]=1*a[1];break;default:return}X.pipi[a[0]]=a[1]}})):X.pipi={},X.pipi.wait=!X.pipi.autostart&&(X.pipi.wait||parent!=window),X.pipi.poster&&(sML.addClass(O.HTML,"with-poster"),O.HTML.style.backgroundImage="url("+X.pipi.poster+")"),!X.bibi.To&&X.epubcfi&&(X.bibi.To=O.getEPUBCFITarget(X.epubcfi))},O.parseHash=function(){if(!location.hash)return{};var a=location.hash.replace(/^#/,""),b=0,c={},d=function(){for(var d=b,e="";/[a-z_]/.test(a.charAt(b));)b++;if("("!=a.charAt(b))return null;for(e=a.substr(d,b-1-d+1),b++;")"!=a.charAt(b);)b++;c[e]=a.substr(d,b-d+1).replace(/^[a-z_]+\(/,"").replace(/\)$/,""),b++};return function(){for(d();","==a.charAt(b);)b++,d()}(),c},O.getBibitoTarget=function(a){if("number"==typeof a&&(a=""+a),"string"!=typeof a||!/^[1-9][0-9]*(-[1-9][0-9]*(\.[1-9][0-9]*)*)?$/.test(a))return null;var b="",c=a.split("-"),d=parseInt(c[0]),e=c[1]?c[1]:null;return e&&sML.each(e.split("."),function(){b+=">*:nth-child("+this+")"}),{BibitoString:a,ItemIndex:d-1,Element:b?"body"+b:null}},O.getEPUBCFITarget=function(a){var b=O.EPUBCFI.parse(a);if(!b||b.Path.Steps.length<2||!b.Path.Steps[1].Index||b.Path.Steps[1].Index%2==1)return null;var c=b.Path.Steps[1].Index/2-1,d=null,e=null,f=null,g=null;return b.Path.Steps[2]&&b.Path.Steps[2].Steps&&(d="",sML.each(b.Path.Steps[2].Steps,function(a){return"IndirectPath"==this.Type?(g=this,!1):"TermStep"==this.Type?(f=this,!1):this.Index%2==1&&(e=this.Index-1,a!=b.Path.Steps[2].Steps.length-2)?!1:void(null===e&&(d=this.ID?"#"+this.ID:d+">*:nth-child("+this.Index/2+")"))}),d&&/^>/.test(d)&&(d="html"+d),d||(d=null)),{CFI:b,CFIString:a,ItemIndex:c,Element:d,TextNodeIndex:e,TermStep:f,IndirectPath:g}},O.getLogo=function(a){return["<",a.Linkify?"a":"span",' class="bibi-logo"',a.Linkify?' href="http://bibi.epub.link/" target="_blank" title="BiB/i | Web Site"':"",">",'<span class="bibi-type-B">B</span>','<span class="bibi-type-i">i</span>','<span class="bibi-type-B">B</span>','<span class="bibi-type-slash">/</span>','<span class="bibi-type-i">i</span>',"</",a.Linkify?"a":"span",">"].join("")},O.Log=(!parent||parent==window)&&console&&console.log,O.log=function(a,b){O.Log&&b&&"string"==typeof b&&(O.showStatus(b),0==a?b="[ERROR] "+b:1==a?b="---------------- "+b+" ----------------":2==a?b=b:3==a?b=" - "+b:4==a&&(b="   . "+b),console.log("BiB/i: "+b))},O.showStatus=function(a){window.status="BiB/i: "+a,O.statusClearer&&clearTimeout(O.statusClearer),O.statusClearer=setTimeout(function(){window.status=""},3210)},O.isBin=function(a){return/\.(gif|jpe?g|png|ttf|otf|woff|mp[g34]|m4[av]|ogg|webm|pdf)$/i.test(a)},O.getPath=function(){return function(a){for(var b=a[0],c=a.length,d=1;c>d;d++)b+="/"+a[d];return b}(arguments).replace(/\/\.\//g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\//g,"/").replace(/^\//,"")},O.toBibiXML=function(a){return a.replace(/<\?[^>]*?\?>/g,"").replace(/<(\/?)([\w\d]+):/g,"<$1$2_").replace(/<(\/?)(opf_)?([^!\?\/ >]+)/g,"<$1bibi_$3").replace(/<([\w\d_]+) ([^>]+?)\/>/g,"<$1 $2></$1>")},O.ContentTypeList={"image/gif":/\.gif$/i,"image/png":/\.png$/i,"image/jpeg":/\.jpe?g$/i,"image/svg+xml":/\.svg$/i,"font/truetype":/\.ttf$/i,"font/opentype":/\.otf$/i,"font/woff":/\.woff$/i,"text/css":/\.css$/i,"text/javascript":/\.js$/i,"text/html":/\.html?$/i,"application/xhtml+xml":/\.xhtml$/i,"application/xml":/\.xml$/i,"application/pdf":/\.pdf$/i},Bibi.plugin.fn=[],Bibi.plugin.bind=function(a,b){return"undefined"==typeof Bibi.plugin.fn[a]&&(Bibi.plugin.fn[a]=[]),Bibi.plugin.fn[a].push(b),[a,Bibi.plugin.fn[a].length-1].join("-")},Bibi.plugin.unbind=function(a){var b=a.split("-");return 1===b.length?void delete Bibi.plugin.fn[a]:void delete Bibi.plugin.fn[b[0]][parseInt(b[1])]},Bibi.plugin.call=function(a){var b,c,d;if("undefined"!=typeof Bibi.plugin.fn[a]){d=Bibi.plugin.fn[a];for(b in d)c=d[b],"function"==typeof c&&c.call()}},Bibi.plugin.addMenu=function(a,b){var c,d=a.id,e=a.label,f=a.img;c=['<span class="bibi-icon"',' title="',e,'"',' id="',d,'"',' style="background: url(',f,') no-repeat center;">',e,"</span>"].join(""),C.Panel.Menu["plugin-menus"].appendChild(sML.create("li",{className:"plugin-menu",innerHTML:c,onclick:function(){b()}}))},Bibi.plugin.deleteMenu=function(a){var b=document.getElementById(a);sML.deleteElement(b)},sML.ready(O.welcome),BibiEPUBCFI={/*!
 *
 *  # BiB/i EPUB-CFI Utilities
 *
 *  - "EPUB-CFI Utilities (for BiB/i, or Others)"
 *  - (c) Satoru MATSUSHIMA - http://sarasa.la/bib/i
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 *  - Sun June 22 23:59:59 2014 +0900
 */
Version:.32,Build:20140622,CFIString:"",Current:0,parse:function(a,b){if(!a||"string"!=typeof a)return null;try{a=decodeURIComponent(a)}catch(c){return this.log(0,"Unregulated URIEncoding."),null}return b&&"string"==typeof b&&"function"==typeof this["parse"+b]||(b="Fragment"),"Fragment"==b&&(a=a.replace(/^(epubcfi\()?/,"epubcfi(").replace(/(\))?$/,")")),this.CFIString=a,this.Current=0,this.Log&&this.LogCancelation&&(this.log(1,"BiB/i EPUB-CFI"),this.log(2,"parse"),this.log(3,"CFIString: "+this.CFIString)),this["parse"+b]()},parseFragment:function(){var a=this.Current,b={};return this.parseString("epubcfi(")?(b=this.parseCFI(),null===b?this.cancel(a):this.parseString(")")?b:this.cancel(a,"Fragment")):this.cancel(a,"Fragment")},parseCFI:function(){var a=this.Current,b={Type:"CFI",Path:{}};if(b.Path=this.parsePath(),!b.Path)return this.cancel(a,"CFI");if(this.parseString(",")){if(b.Start=this.parseLocalPath(),!b.Start.Steps.length&&!b.Start.TermStep)return this.cancel(a,"CFI > Range");if(!this.parseString(","))return this.cancel(a,"CFI > Range");if(b.End=this.parseLocalPath(),!b.End.Steps.length&&!b.End.TermStep)return this.cancel(a,"CFI > Range")}return b},parsePath:function(){var a=this.Current,b={Type:"Path",Steps:[]},c={};return b.Steps[0]=this.parseStep(),b.Steps[0]&&(c=this.parseLocalPath())?(b.Steps=b.Steps.concat(c.Steps),b):this.cancel(a,"Path")},parseLocalPath:function(){var a=(this.Current,{Type:"LocalPath",Steps:[]}),b=a,c=null,d=null;for(c=this.parseStep("Local");null!==c&&(b.Steps.push(c),c=this.parseStep("Local"));)if("IndirectStep"==c.Type){var e={Type:"IndirectPath",Steps:[]};b.Steps.push(e),b=e}else if("TermStep"==c.Type){d=c;break}return d&&b.Steps.push(d),a.Steps.length?a:null},parseStep:function(a){var b=this.Current,c={};if(this.parseString("/"))c.Type="Step";else if(a&&this.parseString("!/"))c.Type="IndirectStep";else{if(!a||!this.parseString(":"))return this.cancel(b,"Step");c.Type="TermStep"}if(c.Index=this.parseString(/^(0|[1-9][0-9]*)/),null===c.Index)return this.cancel(b,"Step");if(c.Index=parseInt(c.Index),this.parseString("[")){if("TermStep"!=c.Type){if(c.ID=this.parseString(/^[_a-zA-Z][_a-zA-Z0-9\-]+/),!c.ID)return this.cancel(b,"Step > Assertion > ID")}else{var d=[],e=null,f=/^((\^[\^\[\]\(\)\,\;\=])|[_a-zA-Z0-9%\- ])*/;if(d.push(this.parseString(f)),this.parseString(",")&&d.push(this.parseString(f)),d[0]&&(c.Preceding=d[0]),d[1]&&(c.Following=d[1]),this.parseString(/^;s=/)&&(e=this.parseString(/^[ab]/)),e&&(c.Side=e),!c.Preceding&&!c.Following&&!c.Side)return this.cancel(b,"Step > Assertion > TextLocation")}if(!this.parseString("]"))return this.cancel(b,"Step > Assertion")}return c},parseString:function(a){var b=null;if(a instanceof RegExp){var c=this.CFIString.substr(this.Current,this.CFIString.length-this.Current);a.test(c)&&(a=c.match(a)[0],this.Current+=a.length,b=a)}else this.CFIString.substr(this.Current,a.length)===a&&(this.Current+=a.length,b=a);return this.correct(b)},correct:function(a){return this.Log&&this.LogCorrection&&a&&this.log(3,a),a},cancel:function(a,b){return this.Log&&this.LogCancelation&&this.log(4,"cancel: parse"+b+" ("+a+"-"+this.Current+"/"+this.CFIString.length+")"),"number"==typeof a&&(this.Current=a),null},log:function(a,b){this.Log&&console&&console.log&&(0==a?b="[ERROR] "+b:1==a?b="---------------- "+b+" ----------------":2==a?b=b:3==a?b=" - "+b:4==a&&(b="   . "+b),console.log("BiB/i EPUB-CFI: "+b))}};