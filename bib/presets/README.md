



指定マニュアル 2014/07/22 版
====================================================================================================




かんたんですが、プリセットについて解説します。今後マニュアルにまとめる計画ですので、読みづらさはしばしご容赦ください。




プリセットとは / つかいかた
----------------------------------------------------------------------------------------------------

プリセットファイルとは、リーダとしてのデフォルト挙動やレイアウトの初期設定を外部化したテキストファイルです。
これを編集することでビビをカスタマイズすることができます。書式は、というか実態は JavaScript のオブジェクトです。

プリセットファイルは bib/preset/ フォルダに入れてつかいます。
このフォルダ内に入れておけば、アクセス時に URL のハッシュにつける bibi(preset:ファイル名.js) で使い分けることができます。

EPUB をドラッグアンドドロップしてもらうときも予め設定を読ませておけますし、
サーバに置いた EPUB やフォルダを読むときも、プリセットをペアにした URL を発行できます。

* http://anatano.website/bib/i/#bibi(preset:PRESET.js)
* http://anatano.website/bib/i/?book=EPUB.epub#bibi(preset:PRESET.js)
* http://anatano.website/bib/i/?book=EPUB#bibi(preset:PRESET.js)

指定がないときは、bib/preset/ フォルダ内にある default.js が使用されます。
まずは default.js を編集して使うのがよいかもしれません。

以下、具体的な指定について説明しますが、
多くは、対象とする EPUB によって一長一短があります。
だからこそプリセットとして編集可能にしてあるというわけです。

読者自身が読みながらボタンで変更できる項目もありますが、
ご自身で作成した EPUB を読者に見せたい場合や、
ご自身で見た目をカスタマイズした BiB/i を読者に使ってもらいたい場合など、
EPUB に合わせたスタイルやあなたらしいスタイルを予めプリセットで指定しておくと、
きっとステキだと思います。



### この文書内で使用される用語の定義

アイテムとは、表示されるファイルひとつひとつのことです。

「見開き」とは、アイテムをつつむブロックです。
リフロー指定のアイテムはそれ１つだけで「見開き」を構成します。
固定レイアウトで左右ペアが作られている場合は、その２つが１つの「見開き」に入ります。

「長さ」は、見開きの進行方向サイズのことです。
横並びなら左右幅、縦並びなら上下高にあたります。
同様に「広さ」は、横並びなら上下高、縦並びなら左右幅です。
そして、それらの数値が小さい状態を「短い」「狭い」ということにします。




name: "なまえ" …… プリセットの任意名称
----------------------------------------------------------------------------------------------------

いまのところどこにも使用されていませんが、
いつかコントロールパネルからプリセットを切り替える機能をつけるかもしれず、
その暁には設定パネル内でラベルとして使用される予定であります。




description: "説明" …… プリセットの内容説明
----------------------------------------------------------------------------------------------------

これも、切り替え機能で使うかもしれない予定です。




"book-display-mode" …… 表示モードの初期値（全部・「見開き」ごと）
----------------------------------------------------------------------------------------------------

"all" を指定すると、書籍の表示データすべてを並べます。
"each" では「見開き」単位に表示して、端まで表示すると、画面端のクリックで前後のアイテムに切り替えるようになります。
読者は随時変更できるので、あくまで最初にどのモードで表示するか、ということです。

ただし、"each" が有効なのは WebKit / Blink のみです。
他のブラウザではこの指定を無視して "all" として動作します。読者も変更できません。




"page-progression-direction" …… ページめくり方向の初期値
----------------------------------------------------------------------------------------------------

EPUB 側で page-progression-direction が未指定もしくは "default" だった場合に、
ページめくり方向として選択されます。
BiB/i はスクロールベースのリーダなので「ページってなんだよ」と思われるかもしれませんが、
これは固定レイアウトで２ページが見開きになるときの配置方向にも関わるのです。
また、固定レイアウトや縦書きのときはスクロール方向にも反映されます。

オプションにせず "ltr" 固定にしようかとも思いました。
というのも、世界的に考えてあたりまえといえばあたりまえなのですが、
「リーダ側のデフォルトは "ltr" である」という想定でつくられている EPUB が大半なのです。

でも「リーダ側のデフォルトは "ltr" である《べき》」という仕様はありませんでしたので、
単純に暗黙の了解にしてしまうのもなんだかなと思い、残してあります。

とはいえ、"ltr" としておくのがオススメです。

たとえば、日本語縦書きやアラビア語に特化した最適化をしたいときなど、
非常に限られた場合に、"rtl" にしておくと便利な場合が、あるかもしれません。
ただ、ふつうは実際問題として困ったことになる場合がほとんどかと思います。




"spread-layout-axis" …… 見開き配置方向の初期値
----------------------------------------------------------------------------------------------------

"auto" / "vertical" / "horizontal" の３つが指定でき、それに基づいて、
内部的な値である "spread-layout-direction" が "ttb" / "ltr" / "rtl" のいずれかに落とし込まれます。

"spread-layout-axis" も "spread-layout-direction" も、
EPUB に指定された rendition:layout（リフローか固定か）や page-progression-direction（ページ送り方向）、
そして前述したプリセットの "page-progression-direction" などによって値が決定されます。

ページめくり方向が "ltr" / "rtl" を想定して作成されている EPUB に敢えて "vertical" を指定すると（その逆も）、
意外と便利だったり読みやすかったりする場合があります。

いずれにせよこれはデフォルト値で、
見開き配置方向＝スクロール方向は、ボタンで読者が随時変更できます。（随時の変更は WebKit / Blink のみ）




"page-size-format" …… 仮想「ページ」の比率
----------------------------------------------------------------------------------------------------

ビビはスクロールベースのリーダですが、
仮想の「ページ」という概念を持っています。

この設定項目は「ページ」の寸法比率をどのようにとるかの設定で、
横書きの本を横配置（縦書きの本を縦配置）したときの段組幅や、
前後移動アローを押したときの移動距離に関わります。

"auto" / "window" / "portrait" / "landscape" が指定できますが、この仕様はまだ不確定です。
いまは "auto" にしておくのがオススメですが、
横書きの本を横配置するときなどに "portrait" がキレイにはまる場合があります。

いずれ、読者が変更できるようにボタンをつける予定です。




"book-background" …… 見開きの下の背景
----------------------------------------------------------------------------------------------------

CSS の background そのままでどうぞ。つまり背景画像なども使えます。




"spread-gap" …… 見開きと見開きの間隔（旧 "spread-separation"）
----------------------------------------------------------------------------------------------------

見開き同士の間隔です。単位は px。

"spread-layout-direction" が "vertical"（"ttb"）なら上下、
"horizontal"（"ltr" / "rtl"）なら左右の間隔です。

最初と最後の見開きとウィンドウ端の距離は、この半分の値になります。
その計算を「美しく」行うため、プリセットで奇数値が指定されていても、1足して強制的に偶数にしています。
（小数点以下を含む指定は偶数奇数の判断の前に四捨五入してしまいます）

ただし、最初と最後の見開きについては、もしウィンドウよりも幅が狭い場合、
ウィンドウの真ん中に来るようにウィンドウ端との距離が調節されます。




"spread-margin-start" / "spread-margin-before" …… 見開きとウィンドウの間隔
----------------------------------------------------------------------------------------------------

見開きとウィンドウの、見開き配置方向と垂直方向にあたる側の間隔です。単位は px。

"spread-margin-start" は、
"spread-layout-direction" が "vertical"（"ttb"）の場合、
"page-progression-direction" が "ltr" ならば左、"rtl" なら右です。
"spread-layout-direction" が "horizontal"（"ltr" / "rtl"）なら 上となります。

"spread-margin-end" は "spread-margin-start" の反対側です。


"spread-border-radius" …… 見開きのカドを丸めるならその半径
----------------------------------------------------------------------------------------------------

CSS 3 でできるようになったことのうち、
多くのウェブ制作者がもっともわかりやすく小躍りしたという言い伝えがある、カド丸指定です。
CSS の border-radius そのままなので、お好みでどうぞ。




"spread-box-shadow" …… 見開きに影を付けるなら CSS を
----------------------------------------------------------------------------------------------------

カド丸に並びウェブ制作者を小躍りさせたと語り伝えられる、ドロップシャドウ。
CSS の box-shadow そのままです。

影を付けるとすこしスクロールがもたつくかもしれませんので、
ないほうがいいかもしれませんね。不要なら "none" もしくは "" としてください。




"item-padding-left" / "****-right" / "****-top" / "****-bottom" …… 各アイテム内の余白
----------------------------------------------------------------------------------------------------

見開きの内側、EPUB 内の各 HTML が描画される領域までの余白です。

数値の単位はすべて px（ピクセル）。

グチですが……ホントは全部 0 でいいはずじゃないかと思うんです。
ただ、iBooks はじめ、制御不能な余白をつけるリーディングシステムが幅を利かせています。
あれはほんとうにキライですが、そう言っても仕方ありません。
そうしたリーディングシステムに合わせて余白を持たせていない EPUB がかなり多いため、この項目はそのためにあります。
EPUB 内の HTML に適用された背景色・背景画像もこの余白に反映されるように処理しています。

アイテムが固定レイアウトのときは無視され、余白はとられません。




"item-column-rule" …… 段組されたときの境界線表示
----------------------------------------------------------------------------------------------------

CSS の column-rule そのままです。不要なら "" 空値にしておきます。

ちなみにビビではなく CSS の領分の話ですが、この線の太さは、column-gap に影響しません。




"fit-images" / "fit-images_breadth-only" …… 画像サイズの自動調整
----------------------------------------------------------------------------------------------------

素直に表示するだけでは、コンテンツ内の画像がウィンドウ内に収まらないことがあります。

"fit-images" を "always" にすると、そうした画像をスマートに縮小して、「幅」「長さ」ともウィンドウサイズ未満に収めます。
"no" にすると、EPUB 内の CSS 以上の処理は行いません。しっかり作られていれば "no" でもよいでしょう。
"in-single-image-only-item" にすると、画像１枚だけで構成された HTML や OPF の spine に直接画像が指定されているアイテムのみにはたらきます。

"fit-images_breadth-only" は、"fit-images" が "always"「幅」方向のはみ出しのみを抑制し、「長さ」方向は成り行きに任せます。




"epub-additional-stylesheet" / "epub-additional-script" …… EPUB 内のコンテンツに任意の CSS / JavaScript を追加
----------------------------------------------------------------------------------------------------

EPUB 内のコンテンツを編集することなく、すべてのアイテムに CSS / JavaScript を追加できます。
ご自分のスタイルで読みたい・検証や校正のためのスクリプトを追加して表示確認したい、などの要望に応える機能です。

値には、パスをそのまま指定します。



